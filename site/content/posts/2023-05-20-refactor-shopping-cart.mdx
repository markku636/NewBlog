---
featured: true
title: 優化重構購物車心得 - 使用 React
date:  2023-05-30 01:01:01 +0800
thumbnail: react.png
category: Frontend
tags: ['react','react-refactor-shopping-cart','refactor','shopping-cart']
description : 優化重構購物車心得 - 使用 React
author : Mark Ku
slug: react-refactor-shopping-cart
---
# 前言
在今年初，我們遇到了一個挑戰：舊的結帳流程和React程式碼問題。這些問題不僅導致整頁頻繁刷新，也引起了許多使用者的抱怨，甚至出現錯誤。為了改進購物流程，我們決定進行程式碼重構。該挑戰的主要目標是重新架構一個超過4000行的購物車網站程式碼。在這關鍵時刻，我剛好加入了公司，然而，我對React的了解有限。儘管如此，我與我的團隊現已成功地使用React重構購物車頁面。我希望分享我們是如何解決各種問題並優化程式碼的經驗。

## 遇到的困難
### 解決非同步問題
當數個物件狀態同時寫入時，它們可能會互相覆蓋，或在非同步狀態還未回傳時就呼叫後端API，導致API獲取到舊的值。我們透過React Redux解決了這些問題。

### 解決巢狀JS及 CallBack Hell，提升程式的可讀性
我們的原始程式碼存在著大量的巢狀結構和[回調地獄](http://callbackhell.com/)。為了改進這個狀況，我們採用了ES6的Promise來精簡非同步代碼。此外，我們也採用了早期返回的策略，以降低條件語句的巢狀層級，使得程式碼更易讀和維護。

#### 宣告一個 promise resolve 共通的型別
![](https://hackmd.io/_uploads/BJX8jQ8B3.png)

#### 將原本很多非同步的拆解成 promise 
![](https://hackmd.io/_uploads/ByHnnmIrh.png)

#### 這樣就可以不斷的透過 .then 將結果傳遞下去，程式碼也變得比較好維護
![](https://hackmd.io/_uploads/Bk2xnmIrn.png)

### 函數單一職責原則與提煉
我們的許多方法在不同的地方重覆實作相同的邏輯，這導致程式碼冗餘且混亂。因此，我們採用了單一職責原則，並將這些相同的邏輯提煉為單一的方法。這使得我們的程式碼更簡潔，且系統更容易維護與擴展。

### 元件化共用組件
我們發現在許多地方都有重覆使用的元件及方法。為此，我們將這些元件及方法抽象出來，使它們可以在任何地方被重覆使用。這不僅減少了程式碼行數，還提高了我們的開發效率。React的元件化思維，讓我們

## 上線後問題開始浮現
在上線後，我們開始遇到問題。由於時間和資源的限制，我們選擇繼續使用原有的 API，然而，因為其與我們原本的流程相反，我們在上線後發現了一些錯誤訂單。為了解決這些問題，我們在購物流程和金流中添加了 log，並透過 Seq Alert 監控錯誤訊息。一旦出現錯誤，我們就會立即通過 Teams 進行通知，並逐一修正錯誤，進一步消除 bug。

![](https://hackmd.io/_uploads/S1fbTXIr3.png)
![](https://hackmd.io/_uploads/HJu-6mIr2.png)
![](https://hackmd.io/_uploads/S1GGTXIHn.png)

## 減少 google map api 使用量
每當使用者輸入郵遞區號，我們的系統會頻繁地調用Google Map API，導致API的使用量劇增。為了節省成本，我們優化了系統，採取Redis Cache技術來緩存常用數據。這項策略不僅顯著降低了Google Map API的使用次數，大大節省了我們的開支。

## 最後
經過以上的步驟，我們成功地重構了我們的購物車網站，並解決了我們遇到的問題。這半年的學習與實踐經驗，不僅讓我深入理解React，也使我對程式開發有了更深的認識。我期待著未來的挑戰，並將我所學的知識應用到新的專案中。

結論，這次的經驗教我們，即使在面對巨大的挑戰時，也能從中學習和成長。我們學到了如何用新的工具和技術來解決我們的問題，並成功地重構了我們的購物車網站。

如果你也正面臨著類似的挑戰，我希望我們的經驗可以對你有所幫助。記住，每一個挑戰都是一次學習的機會。只要有足夠的毅力和決心，你也可以成功地解決你的問題，並進一步提升你的開發技能。