---
featured: true
title: ç”¨ Argo CD å¯¦ä½œ GitOpsï¼šå¾ Helm å®‰è£åˆ° GitLab SSO ä¸€æ¬¡æå®š
slug: argocd-gitops-helm-installation-and-gitlab-sso-setup
category: DevOps
thumbnail: argocd-gitops-helm-installation-and-gitlab-sso-setup.png
date: 2025-11-20 10:00:00 +0800
tags: ['Kubernetes', 'Argo CD', 'GitOps', 'Helm', 'GitLab', 'DevOps']
description: ä»¥å¯¦å‹™æ­¥é©Ÿç¤ºç¯„å¦‚ä½•ç”¨ Helm å®‰è£ Argo CDï¼Œä¸¦çµåˆ GitOps èˆ‡ GitLab SSOï¼Œè®“å¤šå¢é›† K8s éƒ¨ç½²ç®¡ç†è‡ªå‹•åŒ–åˆå¯å›æº¯ã€‚
author: Mark Ku
---
## å‰è¨€ï¼šç‚ºä»€éº¼éœ€è¦ Argo CD + GitOpsï¼Ÿ

æƒ³åƒä¸€ä¸‹é€™å€‹å ´æ™¯ï¼š

- ä½ å…¬å¸æœ‰ **10ï½20 å€‹ Kubernetes å¢é›†**  
- æ¯æ¬¡è¦æ›´æ–°æœå‹™ï¼Œéƒ½è¦ï¼š
  - åˆ‡æ› `kubectl context`
  - æ‰¾ YAML
  - `kubectl apply`
  - å†é‡è¤‡ 10ï½20 æ¬¡â€¦

å°±å¥½åƒä½ æœ‰ 20 æ”¯æ‰‹æ©Ÿï¼Œè¦è£åŒä¸€å€‹ Appï¼Œçµæœä½ ä¸€æ”¯ä¸€æ”¯æ‰“é–‹å•†åº—ã€æœå°‹ã€ä¸‹è¼‰ã€ç™»å…¥â€”â€”  
**å¾ˆèŠ±æ™‚é–“ï¼Œä¹Ÿå¾ˆå®¹æ˜“æ¼æ‰æˆ–æŒ‰éŒ¯ã€‚**

**GitOps + Argo CD** åšçš„äº‹æƒ…ï¼Œå°±æ˜¯ï¼š

- æŠŠã€Œä½ æƒ³è¦çš„å¢é›†ç‹€æ…‹ã€å¯«åœ¨ Git è£¡ï¼ˆä¾‹å¦‚ YAML / Helm valuesï¼‰
- è®“ Argo CD è‡ªå‹•å¹«ä½ æŠŠå¢é›†åŒæ­¥æˆ Git è£¡çš„æ¨£å­
- æ‰€æœ‰æ­·å²ç´€éŒ„éƒ½åœ¨ Git è£¡ï¼Œè¦å›æ»¾ä¹Ÿå¾ˆç°¡å–®

ç¼ºé»æ˜¯ï¼Œä¸€é–‹å§‹ä½ è¦å…ˆç†è§£ä¸€äº›åè©ï¼š

- GitOpsï¼šå®£å‘Šå¼ã€å”¯ä¸€çœŸç›¸ä¾†æºï¼ˆSingle Source of Truthï¼‰
- Argo CDï¼šApplicationã€Projectã€Sync
- é€±é‚Šå·¥å…·ï¼šHelmã€OAuth (SSO)ã€Registryã€RBACâ€¦

ä½†ä¸€æ—¦é€™äº›æ¦‚å¿µä¸²èµ·ä¾†ï¼Œ**å¤šå¢é›† + å¤šç’°å¢ƒ** çš„æ—¥å¸¸ç¶­é‹æœƒèˆ’æœéå¸¸å¤šã€‚

é€™ç¯‡æ–‡ç« æœƒå¸¶ä½ ä¸€æ­¥ä¸€æ­¥å®Œæˆä¸‰ä»¶äº‹ï¼š

1. å…ˆææ¸…æ¥šï¼š**Argo CD åœ¨ GitOps è£¡æ‰®æ¼”ä»€éº¼è§’è‰²**  
2. ç”¨ **Helm å®‰è£ Argo CD**ï¼Œä¸¦è£œä¸Šæœ€åŸºæœ¬çš„è¨­å®š  
3. æŠŠ **GitLab SSO ä¸²é€²ä¾†**ï¼Œè®“ä½ ç”¨å…¬å¸ GitLab å¸³è™Ÿç™»å…¥ Argo CD

---

## æ ¸å¿ƒæ¦‚å¿µï¼šå…ˆææ‡‚ GitOps æ˜¯ä»€éº¼

### ä»€éº¼æ˜¯ GitOpsï¼Ÿï¼ˆè¶…ç™½è©±ç‰ˆï¼‰

ä¸€å¥è©±ç‰ˆï¼š

> **ã€ŒæŠŠåŸºç¤è¨­æ–½ç•¶ç¨‹å¼ç¢¼ç®¡ï¼Œä¸€åˆ‡ä»¥ Git ç‚ºæº–ã€‚ã€**

å±•é–‹ä¸€é»å¤§æ¦‚æ˜¯é€™æ¨£ï¼š

- **Git æ˜¯å”¯ä¸€çœŸç›¸ä¾†æº (Single Source of Truth)**  
  - æ‰€æœ‰ Kubernetes è¨­å®šæª”ï¼ˆYAMLã€Helm valuesâ€¦ï¼‰éƒ½æ”¾åœ¨ Git  
  - æƒ³çŸ¥é“ã€Œç¾åœ¨é€™å€‹ç’°å¢ƒæ‡‰è©²é•·ä»€éº¼æ¨£å­ã€â†’ çœ‹ Git å°±å°äº†  

- **ç”±ç³»çµ±è‡ªå‹• applyï¼Œä¸æ˜¯äººæ‰‹ apply**  
  - ä¸æ˜¯ä½ ä¸‹ `kubectl apply` æŠŠæ±è¥¿æ¨é€²å»  
  - è€Œæ˜¯ç”±åƒ Argo CD é€™ç¨®å·¥å…·ï¼Œ**è‡ªå·±å» Git æŠ“è¨­å®š**ã€è‡ªå·±å¹«ä½ å¥—ç”¨åˆ°å¢é›†  

- **å¤©ç„¶æ“æœ‰ç‰ˆæœ¬æ§åˆ¶èˆ‡å›æ»¾èƒ½åŠ›**  
  - èª°æ”¹äº†ä»€éº¼ã€ä»€éº¼æ™‚å€™æ”¹ï¼Œéƒ½æœ‰ commit log  
  - è‹¥é€™æ¬¡è®Šæ›´æœ‰å•é¡Œï¼Œç›´æ¥ Git revert æˆ–åˆ‡å›å‰ä¸€ç‰ˆå³å¯

å¯ä»¥ç”¨ã€Œç…®èœã€ä¾†æ¯”å–»ï¼š

- æ²’æœ‰ GitOpsï¼šæ¯å€‹äººéƒ½æ†‘æ„Ÿè¦ºç…®ï¼Œ**èœè‰²å¾ˆé›£ä¸€è‡´**  
- æœ‰ GitOps + Argo CDï¼šå¤§å®¶éƒ½ç…§åŒä¸€ä»½ã€Œé£Ÿè­œ (Git repo)ã€ï¼Œ  
  å»šå¸«ï¼ˆArgo CDï¼‰æœƒä¸€ç›´æª¢æŸ¥ã€Œæˆå“ã€æ˜¯ä¸æ˜¯è·Ÿé£Ÿè­œä¸€æ¨£ï¼Œä¸ä¸€æ¨£å°±è‡ªå·±èª¿æ•´å›ä¾†ã€‚
> ä¸‹æ–¹çš„ GitLab OAuth è¨­å®šæ­¥é©Ÿå·²é›†ä¸­æ–¼å¾ŒçºŒ SSO ç« ç¯€ï¼Œé€™è£¡ä¸å†è´…è¿°ã€‚

### Step 3ï¼šå»ºç«‹ GitLab Group Access Token

ç‚ºäº†è®“ Argo CD èƒ½å¤ è‡ªå‹•æ‹‰å– GitLab ä¸Šçš„ç¨‹å¼ç¢¼å’Œ Helm Chartï¼Œæˆ‘å€‘éœ€è¦çµ¦å®ƒä¸€æŠŠã€Œè®€å–æ¬Šé™é‘°åŒ™ã€ã€‚Group Access Token å°±æ˜¯é€™æŠŠé‘°åŒ™ï¼Œå®ƒå¯ä»¥è®“ Argo CD å­˜å–æ•´å€‹ GitLab Group åº•ä¸‹çš„æ‰€æœ‰å°ˆæ¡ˆï¼Œè€Œä¸ç”¨æ¯å€‹ repo éƒ½å–®ç¨è¨­å®šä¸€æ¬¡ã€‚

1. å‰å¾€ GitLab Group â†’ `Settings â†’ Access Tokens`
2. å»ºç«‹æ–° Tokenï¼š
   - **Name**ï¼š`argocd-group-readonly`
   - **Scopes**ï¼šå‹¾é¸ `read_repository` å’Œ `read_api`
   - **Role**ï¼šé¸æ“‡ `Reporter`
3. å„²å­˜å¾Œè¤‡è£½ Tokenï¼ˆåªæœƒé¡¯ç¤ºä¸€æ¬¡ï¼‰

### Step 4ï¼šé…ç½® values.yaml

ç¾åœ¨è¦æŠŠå‰é¢æº–å‚™å¥½çš„ã€Œé€šè¡Œè­‰ã€ï¼ˆOAuthï¼‰å’Œã€Œè®€å–é‘°åŒ™ã€ï¼ˆGroup Tokenï¼‰å¯«é€² Argo CD çš„è¨­å®šæª”è£¡ã€‚é€™å€‹ `values.yaml` å°±åƒæ˜¯ Argo CD çš„ã€Œèº«åˆ†è­‰+é€šè¨ŠéŒ„ã€ï¼Œå‘Šè¨´å®ƒè‡ªå·±çš„å°å¤–ç¶²å€æ˜¯ä»€éº¼ã€è¦æ€éº¼è·Ÿ GitLab æºé€šã€å¯ä»¥å­˜å–å“ªäº› repoã€‚

ç·¨è¼¯ `values.yaml`ï¼Œæ•´åˆæ‰€æœ‰è¨­å®šï¼š

```yaml
configs:
  cm:
    # Argo CD å°å¤– URL
    url: http://<your-node-ip>:32009
    
    # GitLab SSO è¨­å®š
    dex.config: |
      connectors:
        - type: gitlab
          id: gitlab
          name: GitLab
          config:
            baseURL: https://gitlab.example.com
            clientID: <your-gitlab-oauth-client-id>
            clientSecret: <your-gitlab-oauth-client-secret>
            redirectURI: http://<your-node-ip>:32009/api/dex/callback
    
  # GitLab Repository èªè­‰ï¼ˆä½¿ç”¨ Group Access Tokenï¼‰
  credentialTemplates:
    gitlab-group-token:
      url: https://gitlab.example.com
      username: oauth2
      password: <your-gitlab-group-access-token>
      
  # é å…ˆè¨»å†Šçš„ Repository
  repositories:
    kong-api-gateway:
      url: https://gitlab.example.com/your-group/kong-api-gateway.git
      type: git
    argocd-deployment:
      url: https://gitlab.example.com/your-group/argocd-deployment.git
      type: git

# Server ç¶²è·¯è¨­å®š
server:
  service:
    type: NodePort
    nodePortHttp: 32009
    nodePortHttps: 32010
  
  # å…è¨± HTTPï¼ˆåƒ…é–‹ç™¼ç’°å¢ƒä½¿ç”¨ï¼‰
  extraArgs:
    - --insecure
```

> ğŸ’¡ **ç”Ÿç”¢ç’°å¢ƒå»ºè­°**ï¼šä½¿ç”¨ Ingress + TLS å–ä»£ NodePortï¼Œä¸¦ç§»é™¤ `--insecure` åƒæ•¸ã€‚

### Step 5ï¼šåŸ·è¡Œå®‰è£

è¨­å®šæª”æº–å‚™å¥½äº†ï¼Œç¾åœ¨å¯ä»¥æ­£å¼æŠŠ Argo CD ã€Œè“‹ã€åˆ° Kubernetes é›†ç¾¤ä¸Šã€‚é€™å€‹éç¨‹æœƒå»ºç«‹æ‰€æœ‰å¿…è¦çš„ Podã€Serviceã€ConfigMap ç­‰ç­‰ï¼Œç„¶å¾Œç­‰å®ƒå€‘å…¨éƒ¨å•Ÿå‹•å®Œæˆã€‚å°±åƒè“‹æˆ¿å­ä¸€æ¨£ï¼Œææ–™å‚™é½Šäº†å°±é–‹å§‹æ–½å·¥ï¼Œæœ€å¾Œé©—æ”¶ç¢ºèªèƒ½ä½äººã€‚

å¥—ç”¨è¨­å®šæª”ä¸¦å®‰è£ Argo CDï¼š

```bash
# å®‰è£ Argo CD
helm upgrade --install homelab-argo argo/argo-cd \
  --version 8.3.2 \
  -f values.yaml \
  -n argocd --create-namespace

# ç­‰å¾… Pod å°±ç·’
kubectl wait --for=condition=ready pod \
  -l app.kubernetes.io/name=argocd-server \
  -n argocd --timeout=300s

# å–å¾—åˆå§‹ admin å¯†ç¢¼
kubectl -n argocd get secret argocd-initial-admin-secret \
  -o jsonpath="{.data.password}" | base64 -d
```

ç™»å…¥å¾Œè«‹ç«‹å³ä¿®æ”¹ admin å¯†ç¢¼ã€‚

---

## æ¬Šé™ç®¡ç†

### Step 6ï¼šè¨­å®š RBAC èˆ‡ AppProject

Argo CD å®‰è£å¥½äº†ï¼Œä½†ç¾åœ¨å®ƒé‚„ä¸çŸ¥é“ã€Œå¯ä»¥ç®¡å“ªäº›è³‡æºã€ã€ã€Œå¯ä»¥éƒ¨ç½²åˆ°å“ªäº›åœ°æ–¹ã€ã€‚AppProject å°±åƒæ˜¯ä¸€ä»½ã€Œæˆæ¬Šæ¸…å–®ã€ï¼Œæ˜ç¢ºå®šç¾© Argo CD å¯ä»¥ç¢°å“ªäº› Kubernetes è³‡æºã€å¯ä»¥é€£åˆ°å“ªäº›é›†ç¾¤ã€å¯ä»¥å­˜å–å“ªäº› Git repoã€‚æ²’æœ‰é€™å€‹æˆæ¬Šï¼ŒArgo CD å°±æœƒå› ç‚ºæ¬Šé™ä¸è¶³è€Œç„¡æ³•æ­£å¸¸å·¥ä½œã€‚

å®‰è£å®Œæˆå¾Œï¼Œéœ€è¦é…ç½® AppProject ä¾†ç®¡ç†æ‡‰ç”¨ç¨‹å¼çš„æ¬Šé™ç¯„åœã€‚

å»ºç«‹ `argocd-projects.yaml`ï¼š

```yaml
apiVersion: v1
kind: List
items:
# Default Project - åŸºæœ¬æ¬Šé™
- apiVersion: argoproj.io/v1alpha1
  kind: AppProject
  metadata:
    name: default
    namespace: argocd
  spec:
    # å…è¨±æ‰€æœ‰ä¾†æº repo
    sourceRepos:
    - '*'
    
    # å…è¨±éƒ¨ç½²åˆ°æ‰€æœ‰å¢é›†èˆ‡ namespace
    destinations:
    - namespace: '*'
      server: '*'
    
    # å…è¨±æ“ä½œé›†ç¾¤ç´šè³‡æº
    clusterResourceWhitelist:
    - group: '*'
      kind: '*'
    
    # å…è¨±æ“ä½œå‘½åç©ºé–“ç´šè³‡æº
    namespaceResourceWhitelist:
    - group: '*'
      kind: '*'

# è‡ªè¨‚ Project - ä¾éœ€æ±‚èª¿æ•´
- apiVersion: argoproj.io/v1alpha1
  kind: AppProject
  metadata:
    name: your-project
    namespace: argocd
  spec:
    description: ä½ çš„å°ˆæ¡ˆæè¿°
    
    sourceRepos:
    - 'https://gitlab.example.com/your-group/*'
    
    destinations:
    - namespace: '*'
      server: https://kubernetes.default.svc
    
    # é›†ç¾¤ç´šè³‡æºç™½åå–®
    clusterResourceWhitelist:
    - group: ''
      kind: Namespace
    - group: 'rbac.authorization.k8s.io'
      kind: ClusterRole
    - group: 'rbac.authorization.k8s.io'
      kind: ClusterRoleBinding
    - group: 'apiextensions.k8s.io'
      kind: CustomResourceDefinition
    
    # å‘½åç©ºé–“ç´šè³‡æºç™½åå–®
    namespaceResourceWhitelist:
    - group: ''
      kind: ConfigMap
    - group: ''
      kind: Secret
    - group: ''
      kind: Service
    - group: ''
      kind: ServiceAccount
    - group: 'apps'
      kind: Deployment
    - group: 'apps'
      kind: StatefulSet
    - group: 'batch'
      kind: Job
    - group: 'batch'
      kind: CronJob
    - group: 'networking.k8s.io'
      kind: Ingress

# Argo CD Controller é¡å¤–çš„ RBAC æ¬Šé™ï¼ˆæ”¯æ´ metrics-server ç­‰ï¼‰
- apiVersion: rbac.authorization.k8s.io/v1
  kind: ClusterRole
  metadata:
    name: argocd-application-controller-auth-delegator
    labels:
      app.kubernetes.io/component: application-controller
      app.kubernetes.io/name: argocd-application-controller
      app.kubernetes.io/part-of: argocd
  rules:
  # Auth delegation for metrics-server
  - apiGroups: ["authentication.k8s.io"]
    resources: ["tokenreviews"]
    verbs: ["create"]
  - apiGroups: ["authorization.k8s.io"]
    resources: ["subjectaccessreviews"]
    verbs: ["create"]
  # API Services management
  - apiGroups: ["apiregistration.k8s.io"]
    resources: ["apiservices"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]

- apiVersion: rbac.authorization.k8s.io/v1
  kind: ClusterRoleBinding
  metadata:
    name: argocd-application-controller-auth-delegator
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: argocd-application-controller-auth-delegator
  subjects:
  - kind: ServiceAccount
    name: argocd-application-controller
    namespace: argocd
```

### å¥—ç”¨è¨­å®š

```bash
# å¥—ç”¨ AppProject èˆ‡ RBAC è¨­å®š
kubectl apply -f argocd-projects.yaml -n argocd

# é©—è­‰ Project æ˜¯å¦å»ºç«‹æˆåŠŸ
kubectl get appprojects -n argocd

# é©—è­‰ RBAC æ˜¯å¦å»ºç«‹æˆåŠŸ
kubectl get clusterrole | grep argocd
kubectl get clusterrolebinding | grep argocd
```

### ç†è§£æ¬Šé™æ¶æ§‹

Argo CD èˆ‡ GitLab æ•´åˆæ¶‰åŠä¸‰å±¤æ¬Šé™ç®¡ç†ï¼š

**1. SSO ç™»å…¥ï¼ˆGitLab OAuthï¼‰**
- æ§åˆ¶ä½¿ç”¨è€…èº«åˆ†é©—è­‰èˆ‡æˆæ¬Š
- æ±ºå®šèª°å¯ä»¥å­˜å– Argo CD UI åŠå¯è¦‹çš„ Application ç¯„åœ
- æœ¬æ–‡å·²åœ¨ Step 4 çš„ `values.yaml` ä¸­å®Œæˆè¨­å®š

**2. Repository å­˜å–ï¼ˆGroup Access Tokenï¼‰**
- è®“ Argo CD è®€å– GitLab å€‰åº«çš„ç¨‹å¼ç¢¼èˆ‡ Helm Chart
- æ¡ç”¨ Group Access Token çµ±ä¸€ç®¡ç†æ•´å€‹ Group çš„æ¬Šé™
- å·²åœ¨ Step 4 çš„ `credentialTemplates` ä¸­å®Œæˆè¨­å®š

**3. Container Registryï¼ˆé¸ç”¨ï¼‰**
- è‹¥ä½¿ç”¨ GitLab Container Registry æ‹‰å–æ˜ åƒæª”ï¼Œéœ€é¡å¤–è¨­å®š
- å¯ä½¿ç”¨ Deploy Token å»ºç«‹ `imagePullSecrets`

> ğŸ’¡ **ç°¡å–®è¨˜æ†¶**ï¼šSSO ç®¡ã€Œäººã€ï¼ŒGroup Token ç®¡ã€Œç¨‹å¼ç¢¼ã€ï¼ŒRegistry Token ç®¡ã€Œæ˜ åƒæª”ã€ã€‚

![](attachments/b8ce9bbd-f83d-4715-96e8-ca016638d3ef.png " =1874x907")


---

## å¯¦æˆ°ç¯„ä¾‹

### æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹ç¸½è¦½

åœ–è¡¨èªªæ˜ ![](attachments/37293e96-21b9-4734-b8b8-8f657ecd65e6.png)

é€™å¼µåœ–ç‰‡æ˜¯ [Argo CD](https://argo-cd.readthedocs.io/en/stable/) çš„æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹ç•«é¢ï¼Œç”¨ä¾†ç®¡ç† Kubernetes æ‡‰ç”¨ç¨‹å¼çš„éƒ¨ç½²ç‹€æ…‹ï¼š


* **æ‡‰ç”¨ç¨‹å¼åç¨±ï¼š** `testapp`
* **APP HEALTHï¼ˆå¥åº·ç‹€æ…‹ï¼‰ï¼š** âœ… **Healthy** â†’ ä»£è¡¨æ‡‰ç”¨ç¨‹å¼ç›®å‰çš„æ‰€æœ‰è³‡æºéƒ½é‹ä½œæ­£å¸¸ã€‚
* **SYNC STATUSï¼ˆåŒæ­¥ç‹€æ…‹ï¼‰ï¼š** âœ… **Synced to HEAD (d227ef5)** â†’ è¡¨ç¤º Git å€‰åº«è£¡çš„è¨­å®šæª”å·²æˆåŠŸåŒæ­¥åˆ°å¢é›†ï¼Œæ²’æœ‰åå·®ã€‚
* **LAST SYNCï¼š** âœ… **Sync OK** â†’ æœ€è¿‘ä¸€æ¬¡åŒæ­¥æˆåŠŸï¼Œæ˜¯åœ¨ `18 hours ago`ï¼ˆ18 å°æ™‚å‰ï¼‰ç”± `mark.ku` å®Œæˆçš„ã€‚ â†’ æäº¤å‚™è¨»ç‚º `update config`ã€‚
* **Auto syncï¼š** âŒ **æœªå•Ÿç”¨è‡ªå‹•åŒæ­¥**ï¼ˆAuto sync is not enabledï¼‰


---

### ğŸŒ³ æ‡‰ç”¨ç¨‹å¼è³‡æºæ¶æ§‹åœ–è§£

é€™æ˜¯ä»¥ GitOps æ¨¡å¼éƒ¨ç½²çš„ Kubernetes æ‡‰ç”¨è³‡æºæ¨¹ç‹€åœ–ï¼š


1. **testappï¼ˆæ‡‰ç”¨ç¨‹å¼ï¼‰**
   * **nginx-contentï¼ˆConfigMapï¼‰**
   * **test-appï¼ˆNamespaceï¼‰**
   * **nginx-test-serviceï¼ˆServiceï¼‰**
   * **nginx-testï¼ˆDeploymentï¼‰**
     * **nginx-test-554867cd4bï¼ˆReplicaSetï¼‰**
       * **nginx-test-554867cd4b-65gtpï¼ˆPodï¼‰**
       * **nginx-test-554867cd4b-xgs9xï¼ˆPodï¼‰**

ğŸ“Œ æ‰€æœ‰è³‡æºå³ä¸Šè§’éƒ½æœ‰ âœ…ï¼Œè¡¨ç¤ºéƒ¨ç½²æˆåŠŸã€ç‹€æ…‹æ­£å¸¸ã€‚

---

## å¸¸ç”¨æŒ‡ä»¤åƒè€ƒ

### Helm ç›¸é—œ

```bash
# å®‰è£ Helmï¼ˆWindowsï¼‰
choco install kubernetes-helm

# å®‰è£/å‡ç´š Argo CD
helm upgrade --install argocd argo/argo-cd \
  --namespace argocd --create-namespace \
  -f values.yaml

# åŒ¯å‡ºç•¶å‰è¨­å®š
helm get values argocd -n argocd -o yaml > current-values.yaml
```

### Kubernetes ç›¸é—œ

```bash
# æŸ¥è©¢ Argo CD Service
kubectl get svc argocd-server -n argocd

# å°‡ Service æ”¹ç‚º NodePort
kubectl patch svc argocd-server -n argocd -p '{
  "spec": {
    "type": "NodePort",
    "ports": [
      {
        "port": 80,
        "targetPort": 8080,
        "nodePort": 32009
      }
    ]
  }
}'

# å–å¾—åˆå§‹ admin å¯†ç¢¼
kubectl -n argocd get secret argocd-initial-admin-secret \
  -o jsonpath="{.data.password}" | base64 -d

# åŒ¯å‡º AppProject è¨­å®š
kubectl get appprojects -n argocd -o yaml > argocd-projects.yaml
```

> âš ï¸ å–å¾— admin å¯†ç¢¼å¾Œï¼Œè«‹ç«‹å³ç™»å…¥ä¸¦ä¿®æ”¹å¯†ç¢¼ä»¥ç¢ºä¿å®‰å…¨ã€‚

---

## ç¸½çµ

é€éæœ¬æ–‡ï¼Œæ‚¨å·²ç¶“å®Œæˆï¼š

1. âœ… ç†è§£ GitOps èˆ‡ Argo CD çš„æ ¸å¿ƒæ¦‚å¿µ
2. âœ… ä½¿ç”¨ Helm å®Œæ•´å®‰è£èˆ‡é…ç½® Argo CD
3. âœ… æ•´åˆ GitLab SSO å¯¦ç¾å®‰å…¨çš„èº«åˆ†é©—è­‰
4. âœ… ä½¿ç”¨ Group Access Token ç®¡ç†å€‰åº«å­˜å–æ¬Šé™
5. âœ… è¨­å®š RBAC èˆ‡ AppProject æ§åˆ¶è³‡æºæ¬Šé™

**ä¸‹ä¸€æ­¥å»ºè­°**ï¼š

- å»ºç«‹æ‚¨çš„ç¬¬ä¸€å€‹ Applicationï¼Œå¯¦éš›é«”é©— GitOps å·¥ä½œæµç¨‹
- å•Ÿç”¨è‡ªå‹•åŒæ­¥åŠŸèƒ½ï¼Œå¯¦ç¾å®Œå…¨è‡ªå‹•åŒ–éƒ¨ç½²
- æ•´åˆ CI/CD Pipelineï¼Œå»ºç«‹å®Œæ•´çš„ DevOps æµç¨‹
- åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­é…ç½® Ingress + TLSï¼Œæå‡å®‰å…¨æ€§

## åƒè€ƒè³‡æ–™

- [Argo CD å®˜æ–¹æ–‡ä»¶](https://argo-cd.readthedocs.io/)
- [Argo CD Helm Chart](https://github.com/argoproj/argo-helm)
- [GitLab OAuth è¨­å®š](https://docs.gitlab.com/ee/integration/oauth_provider.html)
- [Argo CD å¯¦ä½œç¯„ä¾‹](https://blog.csdn.net/cr7258/article/details/122028096)
- [GitOps æœ€ä½³å¯¦è¸](https://ithelp.ithome.com.tw/articles/10266761)