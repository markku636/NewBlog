---
featured: true
title: AI 時代的舊系統重構策略
date: 2025-01-09 01:01:35 +0800
thumbnail: ai-refactoring.jpg
category: Backend
tags: ['ai', 'refactoring', 'architecture']
description: AI 時代的舊系統重構策略
author: Mark Ku
slug: ai-refactoring-strategy
---

## 建立統一入口（前提是舊系統有 API）

所有請求不再直接打進舊系統 IP，而是**統一先走 API Gateway**。

```text
/api/v1/orders  -> 舊系統（Old System）
/api/v2/orders  -> 新微服務（New Microservice）
```

透過版本區分，把新舊系統藏在 Gateway 後面，
就能**一個 API、一個 API 地遷移**，而不是一次全部重寫，也不用一次押上所有風險。

## 整理出讓 AI 能讀懂的架構指引

重點不是文件寫多厚，而是**邏輯與結構的一致性**：

* 系統架構
* 團隊的程式碼風格
* 模組間的關係
* 資料流程圖
* 測試怎麼寫
* 資料夾怎麼放

這些在建構時就用工具強制約束，
AI 才不會「每次都幫你寫一種風格」，也比較能理解你真正想要的架構。

## 盤點重構功能，決定 AI 介入程度

先把需要重構的功能列出來，
依**容錯率**決定 AI 能走多遠：

* 高容錯：AI 可自動產生、快速迭代
* 低容錯：一定要人工驗證、人工決策

不是所有地方都適合全自動，有些地方就是要人眼一行一行看。

## 善用 AI Code Review

讓 AI 先幫忙找問題、看風險、提建議，
但**決策權永遠在工程師手上**。

## 出問題時，怎麼快速發現

一定要有即時觀測指標：

* API error rate
* latency
* 關鍵流程的 商業觀測指標

重構成不成功，數字會先告訴你。

## 埋好 Log，才有東西查

監控看的是「數字」，log 看的是「發生了什麼事」，兩個要一起設計：

* 關鍵流程一定要有 log（例如：登入、下單、付款、匯出報表）
* 每個請求要有 trace id / correlation id，方便串起前後端、舊系統、新系統
* log 內容至少要包含：誰、做了什麼、打到哪支 API、結果是成功還是失敗（含錯誤碼）
* log 等級（info / warn / error）要先定義好，避免所有東西都丟 error 變成噪音

這些先想清楚、埋在架構裡，出事時才不會只有一行「Something went wrong」。

## 短時間查不出來，怎麼退

退路一定要先準備好：

* Git 直接退版
* 或在 API Gateway 切回舊系統
* k8s image rollback 

能退，才敢改。

## 感想

AI 重構的本質，是**降低系統的不確定性**，如果結構複雜也缺乏一致性，那麼原本就很亂的系統，透過AI重構，系統複雜變成放大好幾倍，真正該做的不是期待 AI 幫你重構好一切，輔助你處理協助明確的項目。

* 收斂入口
* 建立一致性
* 清楚哪些能錯、哪些不能錯
* 準備好監控與退路

當系統變得「可被理解」，不管是人，還是 AI，才真的幫得上忙。
