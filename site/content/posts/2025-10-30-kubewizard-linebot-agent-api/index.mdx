---
title: é€é KubeWizard æ‰“é€  LINE Bot Agent APIï¼šç”¨èŠå¤©æ–¹å¼ç®¡ç† Kubernetes
featured: true
date: 2025-10-30 10:00:00 +0800
thumbnail: kubewizard-linebot-agent-api.png
category: DevOps
author: Mark Ku
tags: ['KubeWizard', 'LINE Bot', 'Kubernetes', 'API', 'DevOps', 'Chatbot', 'Python', 'è‡ªå‹•åŒ–']
description: æ‰‹æŠŠæ‰‹å¸¶ä½ æŠŠ KubeWizard æ”¹é€ æˆ LINE Bot Agent APIï¼Œè®“ä½ ä¸é–‹é›»è…¦ã€ä¸ç”¨ kubectlï¼Œä¹Ÿèƒ½ç®¡ç† Kubernetesï¼Œé‚„èƒ½æ”¯æ´è‡ªå‹•åŒ–èˆ‡æ“´å……å·¥å…·ã€‚
slug: kubewizard-linebot-agent-api
---

## å‰è¨€

ç®¡ç† Kubernetes æ™‚ï¼Œæˆ‘å€‘ç¿’æ…£ä½¿ç”¨ `kubectl` æˆ– Dashboardã€‚è‹¥èƒ½ã€Œç”¨èŠå¤©ã€å®ŒæˆæŸ¥è©¢ã€è¨ºæ–·ã€é‡å•Ÿã€å‘Šè­¦å›æ‡‰ï¼Œç¶­é‹é«”é©—æœƒæ›´è²¼è¿‘æ—¥å¸¸æºé€šâ€”çœå»é–‹é›»è…¦ã€æ‰¾ VPNã€è¨˜æŒ‡ä»¤çš„æ‘©æ“¦ã€‚é€™ç¯‡æ–‡ç« æŠŠ **KubeWizard** æ”¹é€ æˆå¯åœ¨ LINE ä¸Šæ“ä½œçš„ **Kubernetes æ™ºèƒ½åŠ©ç† (Agent API)**ï¼ŒåŒæ™‚å…·å‚™ï¼š

- æ–‡å­—äº’å‹•ç®¡ç† K8sï¼ˆæŸ¥è³‡æº / çœ‹ Logs / é‡å•Ÿæœå‹™ï¼‰
- æä¾› REST API äº‹ä»¶å…¥å£ï¼ˆPrometheus / GitOps / Webhookï¼‰
- å¯æ“´å…… Toolsã€AI è¼”åŠ©èˆ‡è‡ªå‹•åŒ–è…³æœ¬
- å¤šä½¿ç”¨è€…ç¨ç«‹è¨˜æ†¶ + æ™ºèƒ½ä¸Šä¸‹æ–‡

æˆ‘å€‘é¸ç”¨ **Google Gemini** åšç‚ºåŸºç¤æ¨¡å‹ï¼ŒåŸå› ï¼š

- æä¾› Free Tierï¼Œè¶³ä»¥æ”¯æ’ä¸­å°å‹ DevOps Agent æµé‡
- èˆ‡ Python / FastAPI / LangChain æ•´åˆç›´æ¥
- å¤šèªç³»ï¼ˆä¸­è‹±æ–‡æŒ‡ä»¤ / æŠ€è¡“æ•˜è¿°ï¼‰ç†è§£ä½³ï¼Œé©åˆç¶­é‹å ´æ™¯

æˆªè‡³ 2025-11 å¸¸ç”¨æ¨¡å‹ Free Tierï¼ˆç¯€éŒ„ï¼‰ï¼š

| æ¨¡å‹ | RPM | TPM |
|------|-----|-----|
| Gemini 2.5 Flash | 10 | 250,000 |
| Gemini 2.5 Flash-Lite | 15 | 250,000 |
| Gemini 2.0 Flash | 15 | 1,000,000 |
| Gemini 2.0 Flash-Lite | 30 | 1,000,000 |
| Gemma 3 / 3n | 30 | 15,000 |
| Embeddings | 100 | 30,000 |

> ä»¥å®˜æ–¹æœ€æ–°æ–‡ä»¶ç‚ºæº–ï¼š[Gemini API Rate limits](https://ai.google.dev/gemini-api/docs/rate-limits)

æ¥ä¸‹ä¾†æˆ‘å€‘å…ˆçœ‹åƒ¹å€¼ â†’ æ¶æ§‹ â†’ æ ¸å¿ƒå…ƒä»¶ â†’ å¯¦ä½œæ­¥é©Ÿï¼›æœ€å¾Œå†å±•ç¤º Demo èˆ‡å»¶ä¼¸æ‡‰ç”¨ã€‚

---

## ä½¿ç”¨ LINE + Agent ç®¡ç† K8s çš„åƒ¹å€¼

### âœ… éš¨æ™‚éš¨åœ°
- ç„¡éœ€ VPN / Terminalï¼Œä¸€æ”¯æ‰‹æ©Ÿå³å¯å®Œæˆå¸¸è¦‹æ“ä½œ
- æ”¯æ´å¤šä½¿ç”¨è€…ï¼Œç¨ç«‹ session è¨˜æ†¶

### ğŸ”— äº‹ä»¶å…¥å£æ•´åˆ
- REST API å¯æ›å…¥ Prometheusã€GitLabã€Argo CDã€AlertManager Webhook
- ç™¼ç”Ÿå‘Šè­¦ â†’ ç›´æ¥å›è¦†è¨ºæ–· + æä¾›æ“ä½œé¸é …

### ğŸ§  æ™ºèƒ½æ“´å……
- Tools æ¨¡å¼ï¼šæŸ¥ K8sã€Pipelineã€Jiraã€Log åˆ†æã€Searchã€HTTP å‘¼å«å…¶ä»– API
- AI å¯ç”Ÿæˆ YAMLã€åšéŒ¯èª¤æ‘˜è¦ã€æä¾›ä¿®å¾©å»ºè­°

### ğŸ¯ å°è©±è¨˜æ†¶
- Redis ä¿å­˜ä¸Šä¸‹æ–‡ + Token Buffer è‡ªå‹•æ‘˜è¦
- ä¾ä½¿ç”¨è€…åˆ†æµï¼Œäº’ä¸å¹²æ“¾

---

## ç³»çµ±ç¸½è¦½èˆ‡æ¶æ§‹åœ–

ä¸‹åœ–å±•ç¤ºæ•´é«”è³‡æ–™æµï¼ˆä½¿ç”¨è€…è¨Šæ¯ â†’ LINE â†’ Webhook â†’ Agent â†’ å·¥å…· â†’ å›è¦†ï¼‰ï¼š

![ç³»çµ±æ¶æ§‹åœ–](flowchart.png)

æ¶æ§‹æ ¸å¿ƒå››å±¤ï¼š

| å±¤ç´š | è§’è‰² | èªªæ˜ |
|------|------|------|
| ä»‹é¢å±¤ | LINE Bot / REST API | å¤šå…¥å£ã€Webhookã€å‘Šè­¦/äº‹ä»¶æ³¨å…¥ |
| æ™ºèƒ½å±¤ | Agent + LLM | æ±ºç­–æ˜¯å¦ä½¿ç”¨å·¥å…·ã€æ•´åˆè¼¸å‡ºã€ç¶­æŒä¸Šä¸‹æ–‡ |
| å·¥å…·å±¤ | KubeTool / Search / RequestsGet / äººå·¥ä»‹å…¥ | å¯æ’æ‹”ï¼Œæ˜“æ“´å……ã€æ¬Šé™éš”é›¢ |
| ç‹€æ…‹å±¤ | Redis / Kubernetes SDK | å°è©±è¨˜æ†¶ã€å¢é›†æ“ä½œã€è³‡æºå¿«ç…§ |

---

## LangChain æ ¸å¿ƒæ¦‚å¿µï¼ˆé€Ÿè®€ç‰ˆï¼‰

LangChain å¹«ä½ æŠŠã€ŒLLM + Tools + è¨˜æ†¶ + Prompt + åŸ·è¡Œè¿´è·¯ã€çµ„æˆä¸€é¡†å¯æ“´å……çš„å¤§è…¦ï¼š

| æ¦‚å¿µ | åœ¨æœ¬å°ˆæ¡ˆ | æ¯”å–» |
|------|-----------|------|
| LLM | `ChatGoogleGenerativeAI` | é¡§å•å¤§è…¦ |
| Prompt | `SYSTEM_PROMPT` | é¡§å•å·¥ä½œèªªæ˜æ›¸ / SOP |
| Tools | `KubeTool`, `RequestsGet`, `search`, `human_console_input` | å·¥å…·ç®± |
| Memory | Redis + Token Buffer | é¡§å•ç­†è¨˜ï¼ˆæœƒè‡ªå‹•ç˜¦èº«ï¼‰|
| Agent | `create_openai_tools_agent` + Executor | æ±ºç­–è¿´è·¯ |
| Scratchpad | `agent_scratchpad` | è‡¨æ™‚æ€è€ƒç´™ |

å·¥ä½œæµç¨‹ï¼šå•é¡Œ â†’ åˆ¤æ–·éœ€å·¥å…· â†’ åŸ·è¡Œå·¥å…· â†’ æ•´åˆå›è¦† â†’ å„²å­˜è¨˜æ†¶ï¼ˆå¿…è¦æ™‚æ‘˜è¦ï¼‰ã€‚

```python
prompt = ChatPromptTemplate.from_messages([
  ("system", SYSTEM_PROMPT),
  MessagesPlaceholder("chat_history"),
  ("user", "{input}"),
  MessagesPlaceholder("agent_scratchpad"),
])

tools = [KubeTool(), RequestsGet(), create_search_tool()]
memory = ConversationTokenBufferMemory(
  llm=llm,
  memory_key="chat_history",
  max_token_limit=2000,
  chat_memory=RedisChatMessageHistory(url=REDIS_URL, session_id=user_id)
)

agent = create_openai_tools_agent(llm, tools, prompt)
executor = AgentExecutor(agent=agent, tools=tools, memory=memory, verbose=True)
reply = executor.invoke({"input": "åˆ—å‡ºæ‰€æœ‰ namespace"})
```

---

## ç‚ºä»€éº¼é¸ Python Kubernetes SDK è€Œéç›´æ¥å‘¼å« kubectl

| é¢å‘ | Python SDK | ç›´æ¥ kubectl |
|------|------------|--------------|
| å®‰å…¨æ€§ | é¿å…å­—ä¸²æ³¨å…¥ | éœ€ç‰¹åˆ¥è™•ç†æŒ‡ä»¤æ‹¼æ¥ |
| éŒ¯èª¤è™•ç† | çµæ§‹åŒ–ä¾‹å¤– | æ–‡å­—è§£æå›°é›£ |
| é«”ç© | è¼•é‡æ˜ åƒ | éœ€é¡å¤–å®‰è£ CLI |
| ç¨‹å¼åŒ–èƒ½åŠ› | ç‰©ä»¶æ“ä½œã€æ˜“å°è£ | éœ€è§£æè¼¸å‡ºå­—ä¸² |
| RBAC æ•´åˆ | åŸç”Ÿæ†‘è­‰/SA | éœ€æ›è¼‰ kubeconfig |

è‡ªå‹•åµæ¸¬ç’°å¢ƒï¼š
```python
def load_k8s_config():
    if os.path.exists("/var/run/secrets/kubernetes.io/serviceaccount/token"):
        config.load_incluster_config()
    else:
        config.load_kube_config()
```

å¸¸è¦‹æ˜ å°„ï¼š`kubectl get pods -n X` â†’ `v1.list_namespaced_pod(namespace=X)`ã€‚

---

## Step 1ï¼šå»ºç«‹ LINE Botï¼ˆå‰ç½®æº–å‚™ï¼‰

1. å‰å¾€ LINE Developersï¼š  
   https://developers.line.biz/console/

2. å»ºç«‹ Provider

3. å»ºç«‹ Messaging API Bot

4. å–å¾— Channel è¨­å®šä¸¦å¯«å…¥ `.env`ï¼š
```env
LINE_CHANNEL_SECRET=ä½ çš„_channel_secret
LINE_CHANNEL_ACCESS_TOKEN=ä½ çš„_access_token
```

5. è¨­å®š Webhook URLï¼Œä¾‹å¦‚ï¼š

```
https://your-domain.com/linebot/callback
```

![](linebot-console.png)
Webhook æ¸¬è©¦å¯ä½¿ç”¨ ngrok é€²è¡Œæœ¬åœ°å…¬é–‹ã€‚

### Webhook Settings å»ºè­°è¨­å®š

| é …ç›® | è¨­å®šå€¼ |
|-------|------------|
| Webhook URL | `https://example.com/linebot/callback` |
| Use webhook | âœ… å•Ÿç”¨ |

> éœ€ä½¿ç”¨ HTTPSã€‚æˆåŠŸå¾Œè«‹é»æ“Š Verify ç¢ºèªã€‚

---

## Step 2ï¼šæ”¹é€ æˆã€ŒLINE Bot Agent APIã€æ ¸å¿ƒå…ƒä»¶

é è¨­çš„ KubeWizard å±¬æ–¼ä¸€æ¬¡æ€§æŸ¥è©¢å·¥å…·ï¼šå•ä¸€å¥ã€ç­”ä¸€å¥ã€‚  
æ¬²æå‡å¯ç”¨æ€§ï¼Œéœ€å°‡å…¶èª¿æ•´ç‚ºå…·å‚™è¨˜æ†¶èƒ½åŠ›ã€å·¥å…·åˆ¤æ–·èˆ‡å¤šå…¥å£èƒ½åŠ›çš„ Agentã€‚

### æ ¸å¿ƒè¨­è¨ˆæ¦‚å¿µ

| å…ƒä»¶ | åŠŸèƒ½ | æŠ€è¡“å¯¦ç¾ |
|------|--------|----------|
| Agent | åˆ†æè¨Šæ¯èˆ‡æ±ºç­–æ˜¯å¦ä½¿ç”¨ Tools | LangChain OpenAI Tools Agent |
| Tools | ä»¥æ’ä»¶å½¢å¼æä¾›åŠŸèƒ½ï¼ˆK8sã€Pipelineã€AI ç­‰ï¼‰ | LangChain BaseTool |
| Memory | ä½¿ç”¨ Redis å„²å­˜ä¸Šä¸‹æ–‡èˆ‡ä½¿ç”¨è€…ç‹€æ…‹ | RedisChatMessageHistory + ConversationTokenBufferMemory |
| API | æä¾› REST API èˆ‡ LINE Webhook | FastAPI |

### åŠŸèƒ½æ¨¡çµ„åŒ–ï¼ˆToolsï¼‰

æ¯é …åŠŸèƒ½ç¨ç«‹ç‚º Toolï¼Œå…·æœ‰é«˜æ“´å……æ€§ã€‚ä»¥ä¸‹æ˜¯å¯¦éš›çš„ KubeTool å¯¦ç¾ï¼š

```python
from langchain_core.tools import BaseTool
from kubernetes import client, config
from pydantic import BaseModel, Field

class KubeInput(BaseModel):
    """Kubernetes å·¥å…·çš„åƒæ•¸æ¨¡å‹"""
    commands: str = Field(
        ...,
        example="kubectl get pods",
        description="è¦åŸ·è¡Œçš„ kubectl ç›¸é—œå‘½ä»¤"
    )

class KubeTool(BaseTool):
    """Kubernetes å·¥å…· - ä½¿ç”¨ Python SDK åŸ·è¡Œ K8s æ“ä½œ"""
    
    name: str = "KubeTool"
    description: str = """åœ¨ Kubernetes é›†ç¾¤ä¸ŠåŸ·è¡Œ k8s ç›¸é—œå‘½ä»¤çš„å·¥å…·ã€‚
    æ”¯æ´ get/describe/logs/list ç­‰æ“ä½œã€‚
    ç‰¹åˆ¥åŠŸèƒ½ï¼š
    - ä½¿ç”¨ 'kubectl list all' å¿«é€ŸæŸ¥çœ‹æ‰€æœ‰ namespace å’Œ pods æ¦‚è¦½
    - ä½¿ç”¨ 'kubectl list namespaces' æŸ¥çœ‹æ‰€æœ‰ namespace
    - ä½¿ç”¨ 'kubectl list pods' æŒ‰ namespace åˆ†çµ„æŸ¥çœ‹æ‰€æœ‰ pods
    """
    args_schema: Type[BaseModel] = KubeInput
    
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        # è‡ªå‹•åˆ¤æ–·ç’°å¢ƒä¸¦è¼‰å…¥é…ç½®
        try:
            config.load_incluster_config()  # Pod å…§ç’°å¢ƒ
            logger.info("ä½¿ç”¨é›†ç¾¤å…§é…ç½® (Pod ç’°å¢ƒ)")
        except:
            config.load_kube_config()  # æœ¬åœ°ç’°å¢ƒ
            logger.info("ä½¿ç”¨æœ¬åœ° kubeconfig é…ç½®")
        
        self.v1 = client.CoreV1Api()
        self.apps_v1 = client.AppsV1Api()
    
    def _run(self, commands: str) -> str:
        """åŸ·è¡Œ kubectl å‘½ä»¤ä¸¦è¿”å›çµæœ"""
        # è§£æå‘½ä»¤ä¸¦è½‰æ›ç‚º SDK API èª¿ç”¨
        # ä¾‹å¦‚ï¼škubectl get pods -n default
        # è½‰æ›ç‚ºï¼šself.v1.list_namespaced_pod(namespace="default")
        ...
```

### Agent åˆ¤æ–·é‚è¼¯

```python
# Agent åˆå§‹åŒ–
from langchain.agents import create_openai_tools_agent, AgentExecutor
from langchain_google_genai import ChatGoogleGenerativeAI

# å®šç¾©å¯ç”¨å·¥å…·
tools = [
    KubeTool(),
    SearchTool(),
    RequestsGet(),
    human_console_input()
]

# å‰µå»º Agent
agent = create_openai_tools_agent(
    llm=ChatGoogleGenerativeAI(model="gemini-2.0-flash"),
    tools=tools,
    prompt=system_prompt
)

agent_executor = AgentExecutor(
    agent=agent,
    tools=tools,
    memory=memory,
    verbose=True
)

# åŸ·è¡Œæµç¨‹ï¼šä½¿ç”¨è€…å•é¡Œ â†’ Agent åˆ†æ â†’ é¸æ“‡å·¥å…· â†’ åŸ·è¡Œ â†’ å›å‚³çµæœ
result = agent_executor.invoke({"input": "åˆ—å‡ºæ‰€æœ‰ pods"})
```

### è¨˜æ†¶åŠŸèƒ½ï¼ˆRedis + Token Managementï¼‰

ä½¿ç”¨ Redis å„²å­˜å°è©±ä¸Šä¸‹æ–‡ï¼Œä¸¦ä½¿ç”¨ Token Buffer ç®¡ç†å°è©±é•·åº¦ï¼š

```python
from langchain_community.chat_message_histories import RedisChatMessageHistory
from langchain.memory import ConversationTokenBufferMemory

# 1. Redis èŠå¤©æ­·å²ï¼ˆæ¯å€‹ç”¨æˆ¶ç¨ç«‹ sessionï¼‰
chat_history = RedisChatMessageHistory(
    url="redis://localhost:6379/0",
    session_id=user_id,  # æ¯å€‹ç”¨æˆ¶æœ‰ç¨ç«‹çš„ session
    key_prefix="chat_history:",
    ttl=3600  # 1 å°æ™‚éæœŸ
)

# 2. Token Buffer Memoryï¼ˆè‡ªå‹•ç®¡ç†å°è©±é•·åº¦ï¼‰
memory = ConversationTokenBufferMemory(
    llm=llm,
    memory_key="chat_history",
    output_key="output",
    return_messages=True,
    max_token_limit=2000,  # é™åˆ¶ Token æ•¸é‡
    chat_memory=chat_history
)

# 3. è‡ªå‹•ç¸½çµæ©Ÿåˆ¶ï¼ˆç•¶å°è©±éé•·æ™‚ï¼‰
if len(chat_history.messages) > 10:
    # ä½¿ç”¨ AI ç¸½çµå°è©±
    summary = llm.invoke(f"ç¸½çµä»¥ä¸‹å°è©±ï¼š{chat_history.messages}")
    chat_history.clear()
    chat_history.add_message(summary)
```

### FastAPI è·¯ç”±è¨­è¨ˆ

```python
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel

app = FastAPI(title="KubeWizard LINE Bot API")

class ChatRequest(BaseModel):
    message: str
    user_id: str

@app.post("/api/chat")
async def chat(request: ChatRequest):
    """èŠå¤©ç«¯é» - æ”¯æ´ REST API èª¿ç”¨"""
    agent = KubeAgent(user_id=request.user_id)
    result = agent.invoke(request.message)
    return {"reply": result["output"], "user_id": request.user_id}

@app.post("/linebot/callback")
async def linebot_callback(request: Request):
    """LINE Bot Webhook ç«¯é»"""
    # é©—è­‰ç°½å
    signature = request.headers.get("X-Line-Signature")
    body = await request.body()
    
    try:
        handler.handle(body.decode(), signature)
    except InvalidSignatureError:
        raise HTTPException(status_code=400, detail="Invalid signature")
    
    return {"status": "ok"}

@linebot_handler.add(MessageEvent, message=TextMessage)
def handle_message(event):
    """è™•ç† LINE è¨Šæ¯"""
    user_id = event.source.user_id
    user_message = event.message.text
    
    # ä½¿ç”¨ KubeAgent è™•ç†è¨Šæ¯
    agent = KubeAgent(user_id=user_id)
    result = agent.invoke(user_message)
    
    # å›è¦† LINE è¨Šæ¯
    line_bot_api.reply_message(
        event.reply_token,
        TextSendMessage(text=result["output"])
    )
```

## æˆ‘å¦‚ä½•ç”¨ã€ŒVibe Codingã€è¿­ä»£æ‰“é€  Agent

æ‰€è¬‚ã€ŒVibe Codingã€æ˜¯æˆ‘åœ¨é€™å€‹å°ˆæ¡ˆä¸­æ¡ç”¨çš„ä¸€ç¨®ã€Œæ„Ÿè¦ºé©…å‹•ã€è¼•é‡è¿­ä»£ã€é–‹ç™¼æ–¹å¼ï¼šä¸å…ˆå¯«æ»¿æ‰€æœ‰è¨­è¨ˆæ–‡ä»¶ï¼Œè€Œæ˜¯è®“ç¨‹å¼ã€LLM å›æ‡‰èˆ‡å·¥å…·è¡Œç‚ºé€æ­¥å‘Šè¨´æˆ‘ä¸‹ä¸€æ­¥è©²ä¿®ä»€éº¼ã€‚æµç¨‹é•·é€™æ¨£ï¼š

1. æœ€å°å¯è¡Œï¼šåªå»ºç«‹ä¸€å€‹ `KubeAgent` + åŸºæœ¬ Prompt + å–®ä¸€å·¥å…· (KubeTool)ã€‚
2. è§€å¯Ÿè¡Œç‚ºï¼šåœ¨ CLI / FastAPI ä¸­ä¸Ÿã€Œåˆ—å‡º podsã€çœ‹çœ‹æ¨¡å‹æ˜¯ä¸æ˜¯æœƒéŒ¯èª¤å¹»æƒ³â†’å¦‚æœæœƒï¼Œå°±åŠ é—œéµå­—è£œå……ã€‚
3. åŠ å·¥å…·ï¼šé€æ­¥åŠ å…¥ `search`, `RequestsGet`, `human_console_input` å·¥å…·ï¼Œæ¯åŠ ä¸€å€‹å°±æ¸¬è©¦ 2~3 æ¢æŒ‡ä»¤ã€‚
4. äººè¨­èª¿æ•´ï¼šPrompt è£¡åŠ ã€Œå…ˆåˆ†æå•é¡Œã€é¿å…æ¨¡å‹ç›´æ¥äº‚çŒœåŸå› ã€‚
5. åŠ å®‰å…¨æ¬„ï¼šåˆ†æˆ `KubeTool`ï¼ˆå®‰å…¨ï¼‰èˆ‡ `KubeToolWithApprove`ï¼ˆå±éšªæ“ä½œå¦‚åˆªé™¤ / é‡å•Ÿï¼‰ã€‚
6. åŠ è¨˜æ†¶ï¼šç”¨ Redis ä¿å­˜ä¸Šä¸‹æ–‡ï¼Œè¶…é 10 å‰‡è‡ªå‹•æ‘˜è¦ â†’ è§€å¯Ÿ Token ä½¿ç”¨æ˜¯å¦å›è½ã€‚
7. è‡ªå‹•ä¸Šä¸‹æ–‡ï¼šåŠ å…¥ã€Œè¼¸å…¥å« 'åˆ—å‡º' + è³‡æºé—œéµå­—ã€æ‰é™„åŠ æ•´é«”é›†ç¾¤ snapshotï¼Œé¿å…æ¯é¡Œéƒ½æµªè²»è³‡æºã€‚
8. Helm åŒ–ï¼šæŠŠæ‰€æœ‰ç’°å¢ƒè®Šæ•¸ã€Secretsã€RBAC æ‹†é€² values.yaml â†’ éƒ¨ç½²ä¸€æ¬¡å¯è¤‡ç”¨ã€‚

ã€ŒVibe Codingã€çš„æ ¸å¿ƒå¿ƒæ³•ï¼š
- åªè§£æ±ºç¾åœ¨çœŸçš„å‡ºç¾çš„å•é¡Œï¼Œä¸é å…ˆéåº¦è¨­è¨ˆã€‚
- æ¯æ¬¡è¿­ä»£éƒ½ç¢ºèªï¼šè¼¸å…¥ â†’ Agent è¡Œç‚º â†’ å·¥å…·å‘¼å« â†’ å›è¦†æ ¼å¼ã€‚
- ç”¨æ—¥èªŒè§€å¯Ÿã€Œæ¨¡å‹æ˜¯å¦è©²ç”¨å·¥å…·å»æ²’ç”¨ã€â†’ ä»£è¡¨ Prompt æˆ–å·¥å…·æè¿°éœ€è¦èª¿æ•´ã€‚
- æŠŠé›£ Debug çš„æ±è¥¿ï¼ˆåƒ kubectl å­—ä¸²ï¼‰æ›æˆå¯ç¨‹å¼åŒ–ï¼ˆPython SDKï¼‰ã€‚

å°æŠ€å·§åˆ†äº«ï¼š
- Prompt ä¸­æ˜ç¢ºåˆ—å‡ºå¸¸èªªå£é ­ç¦ª â†’ å›è¦†èªæ°£ä¸€è‡´ã€‚
- å·¥å…·æè¿°ç”¨ã€Œä½¿ç”¨è€…èªè¨€ã€å–ä»£ç´”æŠ€è¡“è¡“èªã€‚
- å±éšªæ“ä½œæ‹†åˆ†å·¥å…· + äººå·¥ç¢ºèªã€‚
- DEBUG çœ‹æ¨ç†ã€INFO çœ‹å·¥å…·ä½¿ç”¨ï¼Œæ–¹ä¾¿å•é¡Œå®šä½ã€‚

## æŠ€è¡“äº®é»èˆ‡æŒ‘æˆ° & è§£æ±ºæ–¹æ¡ˆ

| ç·¨è™Ÿ | æŠ€è¡“äº®é» / æŒ‘æˆ° | é¢¨éšª / ç—›é» | è§£æ±ºæ–¹æ¡ˆ | å¯¦ä½œæª”æ¡ˆ |
|------|------------------|-------------|-----------|-----------|
| 1 | ç”¨ Python SDK å–ä»£ kubectl | shell æ³¨å…¥ / å¤§æ˜ åƒ / é›£éŒ¯èª¤è™•ç† | å»ºç«‹å‘½ä»¤è§£æ â†’ å°æ‡‰ SDK å‘¼å« â†’ æ ¼å¼åŒ–è¼¸å‡º | `tools/kubetool_sdk.py` |
| 2 | è‡ªå‹•åµæ¸¬é‹è¡Œç’°å¢ƒ | Pod å…§ / æœ¬åœ°å·®ç•°é…ç½® | æª¢æŸ¥ SA token æ˜¯å¦å­˜åœ¨ â†’ `load_incluster_config()` fallback `load_kube_config()` | `utils/k8s_config.py` |
| 3 | å°è©±è¨˜æ†¶è†¨è„¹ | Token æˆæœ¬é«˜ / å›æ‡‰è®Šæ…¢ | `ConversationTokenBufferMemory` + è¶…é 10 å‰‡è‡ªå‹•æ‘˜è¦ | `agents/kube_agent.py` |
| 4 | å¤šä½¿ç”¨è€…éš”é›¢ | è¨˜æ†¶æ··æ·† | Redis session_id åˆ†é–‹ key å‰ç¶´ | `agents/kube_agent.py` |
| 5 | Rate Limit é¢¨éšª | é«˜å³°çˆ†éŒ¯ / è«‹æ±‚å¤±æ•— | é¸ç”¨ Flash æ¨¡å‹ + å¯åŠ é‡è©¦ï¼ˆTenacityï¼‰é ç•™ | ï¼ˆå¯æ“´å……ï¼‰ |
| 6 | å±éšªæ“ä½œé¢¨éšª | èª¤åˆªè³‡æº | æ‹†å‡º `KubeToolWithApprove` éœ€äººå·¥ç¢ºèª | `tools/kubetool_sdk.py` |
| 7 | éåº¦ä¸Šä¸‹æ–‡æµªè²»è³‡æº | æ¯é¡Œéƒ½æŸ¥æ•´é›†ç¾¤ | é—œéµå­—åˆ¤æ–·å¾Œæ‰é™„åŠ é›†ç¾¤æ¦‚è¦½ | `agents/kube_agent.py` `_enhance_input_with_k8s_context` |
| 8 | RBAC æ¬Šé™æ§ç®¡ | éåº¦æˆæ¬Š / éƒ¨ç½²å¤±æ•— | Helm values æ§åˆ¶ `clusterWide` + å»ºè­° Namespace Scoped | `helm/values.yaml` |
| 9 | éƒ¨ç½²å¯æ”œæ€§ | Dev / Prod è¡Œç‚ºä¸ä¸€è‡´ | ä½¿ç”¨ç’°å¢ƒè‡ªé©æ‡‰ + Helm + Docker Compose | `Dockerfile`, `docker-compose.yml`, `helm/` |
|10 | å›è¦†æ ¼å¼æ˜“æ··äº‚ | ä½¿ç”¨è€…é›£å¿«é€Ÿç†è§£ | å¼·åˆ¶åœ¨ä¸Šä¸‹æ–‡æ’å…¥æ ¼å¼æç¤ºï¼ˆFinal Answer è¦åˆ—å‡ºå®Œæ•´è³‡æºï¼‰ | `agents/kube_agent.py` |
|11 | Log è¨ºæ–·é«˜å™ªéŸ³ | æ¨¡å‹å›ç­”ä¸ç²¾æº– | æŠ½å–éŒ¯èª¤é—œéµè¡Œ + çµ¦å‡º 3 æ¢æ¨è«–æŒ‡å¼• |ï¼ˆå¯åœ¨æœªä¾†å¼·åŒ–ï¼‰|
|12 | äººå·¥ä»‹å…¥éœ€æ±‚ | æ¨¡å‹ä¸æ‡‚æ¥­å‹™é‚è¼¯ | `human_console_input` å·¥å…·è®“ä½¿ç”¨è€…è£œå……è³‡è¨Š | `tools/human.py` |

ç°¡åŒ–çš„ kubectl â†’ SDK æ˜ å°„ç¯„ä¾‹ï¼š
```python
def map_command(cmd: str):
  parts = cmd.split()
  if parts[:3] == ["kubectl", "get", "pods"]:
      ns = "default"
      if "-n" in parts:
          ns = parts[parts.index("-n") + 1]
      return v1.list_namespaced_pod(namespace=ns)
  raise ValueError("æš«ä¸æ”¯æ´çš„æŒ‡ä»¤")
```

> è¨»ï¼šæ­¤è¡¨åˆ—å‡ºå·²å®Œæˆèˆ‡é ç•™å¼·åŒ–çš„é …ç›®ï¼Œå¾ŒçºŒå¯åŠ å…¥ï¼šè‡ªå‹•é‡è©¦ã€å·¥å…·ä½¿ç”¨çµ±è¨ˆã€Prometheus æŒ‡æ¨™ã€‚

ï¼ˆæŠ€è¡“é¸å‹å·²å‰ç§»ï¼ŒåŸæ®µè½åˆä½µè‡³å‰é¢ï¼‰
## ï¸ RBAC æ¬Šé™è¨­å®šï¼ˆå»ºè­°ï¼‰

ä»¥ä¸‹ç‚ºå»ºè­°çš„æœ€å°å¿…è¦æ¬Šé™ï¼Œæ”¯æ´ **Namespace Scoped** å’Œ **Cluster Wide** å…©ç¨®æ¨¡å¼ã€‚

### Namespace Scopedï¼ˆæ¨è–¦ - æœ€å°æ¬Šé™åŸå‰‡ï¼‰

**é©ç”¨å ´æ™¯ï¼š**
- åªéœ€è¦ç®¡ç†ç‰¹å®š namespace çš„è³‡æº
- ä¸éœ€è¦ cluster-admin æ¬Šé™å³å¯éƒ¨ç½²
- æ›´å®‰å…¨ã€æ›´ç¬¦åˆä¼æ¥­å®‰å…¨è¦ç¯„

```yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: kubewizard-bot
  namespace: default
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: kubewizard-bot-role
  namespace: default
rules:
  # Core è³‡æº
  - apiGroups: [""]
    resources: ["pods", "services", "endpoints", "events", "configmaps", "secrets", "persistentvolumeclaims"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  
  # Pod logsï¼ˆåªéœ€è®€å–æ¬Šé™ï¼‰
  - apiGroups: [""]
    resources: ["pods/log"]
    verbs: ["get", "list"]
  
  # Apps è³‡æº
  - apiGroups: ["apps"]
    resources: ["deployments", "replicasets", "statefulsets", "daemonsets"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  
  # Batch è³‡æº
  - apiGroups: ["batch"]
    resources: ["jobs", "cronjobs"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  
  # Networking è³‡æº
  - apiGroups: ["networking.k8s.io"]
    resources: ["ingresses", "networkpolicies"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: kubewizard-bot-binding
  namespace: default
subjects:
  - kind: ServiceAccount
    name: kubewizard-bot
    namespace: default
roleRef:
  kind: Role
  name: kubewizard-bot-role
  apiGroup: rbac.authorization.k8s.io
```

### Cluster Wideï¼ˆé€²éšä½¿ç”¨ï¼‰

**é©ç”¨å ´æ™¯ï¼š**
- éœ€è¦è·¨ namespace ç®¡ç†è³‡æº
- éœ€è¦æŸ¥çœ‹ nodesã€namespaces ç­‰é›†ç¾¤ç´šåˆ¥è³‡æº
- éœ€è¦ cluster-admin æ¬Šé™ä¾†éƒ¨ç½²

```yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: kubewizard-bot
  namespace: default
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: kubewizard-bot-cluster-role
rules:
  # Namespace ç´šåˆ¥è³‡æºï¼ˆæ‰€æœ‰ namespaceï¼‰
  - apiGroups: [""]
    resources: ["pods", "services", "endpoints", "events", "configmaps", "secrets", "persistentvolumeclaims"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  
  - apiGroups: [""]
    resources: ["pods/log"]
    verbs: ["get", "list"]
  
  - apiGroups: ["apps"]
    resources: ["deployments", "replicasets", "statefulsets", "daemonsets"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  
  - apiGroups: ["batch"]
    resources: ["jobs", "cronjobs"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  
  - apiGroups: ["networking.k8s.io"]
    resources: ["ingresses", "networkpolicies"]
    verbs: ["get", "list", "watch"]
  
  # Cluster ç´šåˆ¥è³‡æºï¼ˆåªè®€ï¼‰
  - apiGroups: [""]
    resources: ["nodes", "namespaces", "persistentvolumes"]
    verbs: ["get", "list", "watch"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kubewizard-bot-cluster-binding
subjects:
  - kind: ServiceAccount
    name: kubewizard-bot
    namespace: default
roleRef:
  kind: ClusterRole
  name: kubewizard-bot-cluster-role
  apiGroup: rbac.authorization.k8s.io
```

### Helm Chart é…ç½®ï¼ˆæ¨è–¦ï¼‰

å°ˆæ¡ˆå·²åŒ…å«å®Œæ•´çš„ Helm Chartï¼Œå¯é€é `values.yaml` è¼•é¬†é…ç½®ï¼š

```yaml
# values.yaml

# RBAC é…ç½®
rbac:
  # æ˜¯å¦å‰µå»º RBAC è³‡æº
  create: true
  
  # ä½¿ç”¨ Role (false) æˆ– ClusterRole (true)
  # è¨­ç‚º false å¯é¿å…éœ€è¦ cluster-admin æ¬Šé™
  clusterWide: false
  
  # è‡ªå®šç¾© RBAC è¦å‰‡
  rules:
    - apiGroups: [""]
      resources: ["pods", "services"]
      verbs: ["get", "list", "watch"]
```

**éƒ¨ç½²æ–¹å¼ï¼š**

```bash
# 1. Namespace Scoped éƒ¨ç½²ï¼ˆæ¨è–¦ï¼‰
helm install kubewizard ./helm \
  --set rbac.clusterWide=false \
  --set secrets.AI_GOOGLE_API_KEY="your-api-key" \
  --namespace default

# 2. Cluster Wide éƒ¨ç½²
helm install kubewizard ./helm \
  --set rbac.clusterWide=true \
  --set secrets.AI_GOOGLE_API_KEY="your-api-key" \
  --namespace default

# 3. é©—è­‰ RBAC æ¬Šé™
kubectl auth can-i list pods \
  --as=system:serviceaccount:default:kubewizard-bot \
  -n default
```

### æ¬Šé™é©—è­‰èˆ‡æ¸¬è©¦

```bash
# æ¸¬è©¦ ServiceAccount æ¬Šé™
kubectl create serviceaccount kubewizard-bot -n default
kubectl apply -f rbac.yaml

# é©—è­‰æ¬Šé™
kubectl auth can-i get pods \
  --as=system:serviceaccount:default:kubewizard-bot \
  -n default
# æ‡‰è©²è¿”å›ï¼šyes

# æ¸¬è©¦åœ¨ Pod ä¸­åŸ·è¡Œ
kubectl run test-pod \
  --image=python:3.11-slim \
  --serviceaccount=kubewizard-bot \
  -n default \
  -- sleep 3600

# é€²å…¥ Pod æ¸¬è©¦
kubectl exec -it test-pod -n default -- python3
>>> from kubernetes import client, config
>>> config.load_incluster_config()
>>> v1 = client.CoreV1Api()
>>> pods = v1.list_namespaced_pod(namespace="default")
>>> print(len(pods.items))
```

### å®‰å…¨æœ€ä½³å¯¦è¸

1. **æœ€å°æ¬Šé™åŸå‰‡**ï¼šå„ªå…ˆä½¿ç”¨ Namespace Scoped Role
2. **é¿å…é€šé…ç¬¦**ï¼šä¸è¦ä½¿ç”¨ `resources: ["*"]`
3. **é™åˆ¶å±éšªæ“ä½œ**ï¼šåˆªé™¤æ“ä½œå»ºè­°ä½¿ç”¨äººå·¥å¯©æ‰¹
4. **å®šæœŸå¯©æŸ¥**ï¼šå®šæœŸæª¢æŸ¥ RBAC æ¬Šé™æ˜¯å¦éå¤§
5. **ä½¿ç”¨ Pod Security Policies**ï¼šé™åˆ¶ Pod çš„å®‰å…¨ä¸Šä¸‹æ–‡

---

## è³‡è¨Šæµç¤ºæ„ï¼ˆç™½è©±ç‰ˆï¼‰

ä½¿ç”¨è€…è¼¸å…¥ï¼š  
> ã€Œå¹«æˆ‘çœ‹ä¸€ä¸‹ kube-system è£¡çš„ Podsã€

æµç¨‹ï¼š

1. LINE æ”¶åˆ°è¨Šæ¯  
2. Webhook å‚³è‡³ FastAPI  
3. FastAPI å°‡å…§å®¹äº¤çµ¦ Agent  
4. Agent å¾ Redis å–å¾—ä¸Šä¸‹æ–‡  
5. Agent åˆ¤å®šéœ€ä½¿ç”¨ K8sTool  
6. åŸ·è¡Œ Python SDK æŸ¥è©¢å¢é›†  
7. å›å‚³å…§å®¹è‡³ LINE  

---

## Demo ç¤ºä¾‹ï¼ˆæ–‡å­—ç‰ˆï¼‰

### ç¯„ä¾‹ 1ï¼šæŸ¥è©¢ Pods ç‹€æ…‹

**ä½ ï¼š** å¹«æˆ‘çœ‹ default namespace çš„ Pods  
**Botï¼š** 
```
ğŸ“¦ Namespace: default
================================
NAME                         READY   STATUS              RESTARTS   AGE
nginx-deployment-7d8f...     1/1     Running            0          2d
redis-master-0               1/1     Running            0          5d
payment-service-abc123       0/1     CrashLoopBackOff   5          10m

ç¸½è¨ˆ: 3 pods (2 Running, 0 Pending, 1 CrashLoopBackOff)
âš ï¸ ç™¼ç¾å•é¡Œ: payment-service-abc123 è™•æ–¼ CrashLoopBackOff ç‹€æ…‹
éœ€è¦æŸ¥çœ‹ Logs å—ï¼Ÿ
```

**ä½ ï¼š** çœ‹ä¸€ä¸‹é‚£å€‹ Crash çš„ Log  
**Botï¼š** 
```
ğŸ” payment-service-abc123 çš„æœ€è¿‘æ—¥èªŒï¼š

2025-11-22 10:30:15 [ERROR] Failed to connect to database
2025-11-22 10:30:15 [ERROR] Connection refused: mysql:3306
2025-11-22 10:30:15 [FATAL] Application startup failed

ğŸ’¡ å¯èƒ½åŸå› ï¼š
1. MySQL Service ä¸å­˜åœ¨æˆ–ç„¡æ³•è¨ªå•
2. ç’°å¢ƒè®Šæ•¸é…ç½®éŒ¯èª¤ï¼ˆDB_HOSTï¼‰
3. ç¶²çµ¡ç­–ç•¥é˜»æ“‹é€£ç·š

å»ºè­°æª¢æŸ¥ï¼š
- kubectl get svc -n default | grep mysql
- ç¢ºèª Pod çš„ç’°å¢ƒè®Šæ•¸è¨­å®š
```

**ä½ ï¼š** å¹«æˆ‘é‡å•Ÿçœ‹çœ‹  
**Botï¼š** 
```
ğŸ”„ æ­£åœ¨é‡å•Ÿ Deployment: payment-service

âœ… å·²åŸ·è¡Œï¼škubectl rollout restart deployment/payment-service -n default
â³ ç­‰å¾…æ–° Pod å•Ÿå‹•ä¸­...

ğŸ“Š æ›´æ–°ç‹€æ…‹ï¼š
- èˆŠç‰ˆ Pods: æ­£åœ¨çµ‚æ­¢
- æ–°ç‰ˆ Pods: æ­£åœ¨å‰µå»º
- é è¨ˆå®Œæˆæ™‚é–“: ~30 ç§’

æˆ‘æœƒæŒçºŒç›£æ§ç‹€æ…‹ï¼Œç¨å¾Œå›å ±çµæœã€‚
```

### ç¯„ä¾‹ 2ï¼šè¨ºæ–·ç¶²çµ¡å•é¡Œ

**ä½ ï¼š** ç‚ºä»€éº¼æˆ‘çš„ Ingress ç„¡æ³•è¨ªå•ï¼Ÿ  
**Botï¼š** è®“æˆ‘å¹«ä½ è¨ºæ–· Ingress å•é¡Œã€‚

```
ğŸ” è¨ºæ–·æ­¥é©Ÿï¼š

1ï¸âƒ£ æª¢æŸ¥ Ingress è³‡æº
âœ… Ingress 'my-app' å·²å­˜åœ¨
âœ… Ingress Controller æ­£å¸¸é‹è¡Œ

2ï¸âƒ£ æª¢æŸ¥ Service
âœ… Service 'my-app-svc' å·²å­˜åœ¨ (ClusterIP: 10.96.1.100)

3ï¸âƒ£ æª¢æŸ¥ Pod
âš ï¸ å•é¡Œç™¼ç¾ï¼šService å¾Œç«¯æ²’æœ‰å¯ç”¨çš„ Podï¼

EndpointSlice è³‡è¨Šï¼š
- my-app-svc: 0/3 endpoints ready

ğŸ“‹ å»ºè­°è§£æ±ºæ–¹æ¡ˆï¼š
1. æª¢æŸ¥ Deployment çš„ selector æ˜¯å¦èˆ‡ Service åŒ¹é…
2. æª¢æŸ¥ Pod çš„ labels æ˜¯å¦æ­£ç¢º
3. åŸ·è¡Œï¼škubectl describe service my-app-svc -n default

éœ€è¦æˆ‘å¹«ä½ åŸ·è¡Œé€™äº›æª¢æŸ¥å—ï¼Ÿ
```

### ç¯„ä¾‹ 3ï¼šæ™ºèƒ½ä¸Šä¸‹æ–‡è¨˜æ†¶

**ä½ ï¼š** åˆ—å‡ºæ‰€æœ‰ namespace  
**Botï¼š** 
```
ğŸ“‹ æ‰€æœ‰ Namespacesï¼š
1. default
2. kube-system
3. kube-public
4. production
5. staging
6. monitoring

ç¸½è¨ˆ: 6 å€‹ namespaces
```

**ä½ ï¼š** production è£¡é¢æœ‰ä»€éº¼ï¼Ÿ  
**Botï¼š** *(æ™ºèƒ½è¨˜æ†¶å‰ä¸€å¥çš„ "production" namespace)*
```
ğŸ“¦ Namespace: production
================================

Deployments:
- api-gateway (3/3 Ready)
- user-service (2/2 Ready)
- order-service (5/5 Ready)

Services:
- api-gateway-svc (LoadBalancer)
- user-service-svc (ClusterIP)
- order-service-svc (ClusterIP)

ç¸½è¨ˆ: 3 Deployments, 3 Services, 10 Pods (å…¨éƒ¨æ­£å¸¸)
```

**ä½ ï¼š** é‡å•Ÿ api-gateway  
**Botï¼š** *(è¨˜å¾—æˆ‘å€‘åœ¨è«‡è«– production namespace çš„ api-gateway)*
```
ç¢ºèªè¦é‡å•Ÿ production namespace çš„ api-gateway å—ï¼Ÿ
é€™æœƒå°è‡´çŸ­æš«çš„æœå‹™ä¸­æ–·ã€‚

[å·²ç¢ºèª]

ğŸ”„ æ­£åœ¨åŸ·è¡Œï¼škubectl rollout restart deployment/api-gateway -n production
âœ… é‡å•ŸæˆåŠŸï¼æ–° Pods å·²å•Ÿå‹•ä¸¦å°±ç·’ã€‚
```

![å¯¦éš›æ“ä½œæˆªåœ– 1](result-1.png)
![å¯¦éš›æ“ä½œæˆªåœ– 2](result-2.png)
---

## æ›´å¤šæ‡‰ç”¨å ´æ™¯
ï¼ˆåŸå»¶ä¼¸æ‡‰ç”¨å·²åœ¨çµèªå¾Œï¼Œæå‰æ”¾ï¼Œæ–¹ä¾¿è®€è€…å¿«é€Ÿæƒ³åƒæ“´å……å ´æ™¯â€”â€”å‘Šè­¦ / GitOps / å®šæ™‚ä»»å‹™ï¼‰

**1. å‘Šè­¦è‡ªå‹•è™•ç†**
```python
# Prometheus AlertManager Webhook
@app.post("/webhook/prometheus")
async def prometheus_webhook(alert: PrometheusAlert):
  agent = KubeAgent()
  result = agent.invoke(f"è¨ºæ–·å•é¡Œ: {alert.description}")
  send_line_message(result)
```

**2. GitOps æ•´åˆ**
```python
@app.post("/webhook/argocd")
async def argocd_webhook(event: ArgoCDEvent):
  if event.type == "sync-failed":
    agent = KubeAgent()
    result = agent.invoke(f"åˆ†æåŒæ­¥å¤±æ•—åŸå› : {event.app_name}")
    send_line_message(result)
```

**3. å®šæ™‚å¥åº·æª¢æŸ¥**
```python
@app.get("/cron/health-check")
async def health_check():
  agent = KubeAgent()
  result = agent.invoke("æª¢æŸ¥æ‰€æœ‰ namespace çš„ pod ç‹€æ…‹")
  if "CrashLoopBackOff" in result:
    send_alert("ç™¼ç¾ç•°å¸¸ Podï¼")
```

---

## çµèª

æœ¬æ–‡ç¤ºç¯„å¦‚ä½•å°‡ KubeWizard æ•´åˆè‡³ LINE Botï¼Œæ‰“é€ å‡ºå¯ç®¡ç† K8s çš„èŠå¤©å¼åŠ©ç†ï¼Œå…·å‚™ï¼š

âœ… **æ™ºèƒ½ Agent èƒ½åŠ›**
- ä½¿ç”¨ LangChain èˆ‡ Google Gemini å¯¦ç¾
- è‡ªå‹•åˆ¤æ–·ä½•æ™‚ä½¿ç”¨å“ªå€‹å·¥å…·
- æ”¯æ´è¤‡é›œçš„å¤šæ­¥é©Ÿæ“ä½œ

âœ… **å°è©±è¨˜æ†¶èˆ‡ä¸Šä¸‹æ–‡**
- Redis æŒä¹…åŒ–å„²å­˜å°è©±æ­·å²
- Token Buffer è‡ªå‹•ç®¡ç†å°è©±é•·åº¦
- æ”¯æ´å¤šç”¨æˆ¶ç¨ç«‹ session

âœ… **Python SDK æ“ä½œå¢é›†**
- ä¸ä¾è³´ kubectl äºŒé€²åˆ¶æ–‡ä»¶
- æ›´è¼•é‡çš„ Docker æ˜ åƒï¼ˆç¯€çœ 40% å¤§å°ï¼‰
- è‡ªå‹•åˆ¤æ–· Pod å…§å¤–ç’°å¢ƒ

âœ… **RBAC æ¬Šé™æ§ç®¡**
- æ”¯æ´ Namespace Scoped å’Œ Cluster Wide å…©ç¨®æ¨¡å¼
- éµå¾ªæœ€å°æ¬Šé™åŸå‰‡
- å®Œæ•´çš„ Helm Chart æ”¯æ´

âœ… **ç”Ÿç”¢å°±ç·’**
- å®Œæ•´çš„ Helm Chart èˆ‡ Docker Compose
- å¥åº·æª¢æŸ¥èˆ‡éŒ¯èª¤è™•ç†
- æ”¯æ´æ°´å¹³æ“´å±• (HPA)

### ğŸš€ ç«‹å³é–‹å§‹

**GitHub å°ˆæ¡ˆï¼š** [KubeWizard](https://github.com/markku636/kubewizard)

```bash
# 1. Clone å°ˆæ¡ˆ
git clone https://github.com/markku636/kubewizard.git
cd kubewizard

# 2. é…ç½®ç’°å¢ƒè®Šæ•¸
cp .env.example .env
# ç·¨è¼¯ .envï¼Œå¡«å…¥ä½ çš„ API Key

# 3. ä½¿ç”¨ Docker Compose å•Ÿå‹•
docker-compose up -d

# 4. æ¸¬è©¦ API
curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message":"åˆ—å‡ºæ‰€æœ‰ pods","user_id":"test"}'

# 5. æˆ–ä½¿ç”¨ Helm éƒ¨ç½²åˆ° K8s
helm install kubewizard ./helm \
  --set secrets.AI_GOOGLE_API_KEY="your-api-key" \
  --set secrets.LINE_CHANNEL_SECRET="your-secret" \
  --set secrets.LINE_CHANNEL_ACCESS_TOKEN="your-token"
```

### ğŸ“š å»¶ä¼¸é–±è®€

- [å¿«é€Ÿé–‹å§‹æŒ‡å—](https://github.com/markku636/kubewizard/blob/main/QUICKSTART.md)
- [LINE Bot æ•´åˆæ–‡æª”](https://github.com/markku636/kubewizard/blob/main/kubewizard_linebot/LINE_BOT_README.md)
- [Kubernetes é…ç½®èªªæ˜](https://github.com/markku636/kubewizard/blob/main/docs/K8S_CONFIG_GUIDE.md)
- [Helm Chart éƒ¨ç½²æŒ‡å—](https://github.com/markku636/kubewizard/blob/main/helm/DEPLOYMENT.md)

### ğŸ™ è‡´è¬

ç‰¹åˆ¥æ„Ÿè¬ä»¥ä¸‹é–‹æºå°ˆæ¡ˆï¼š
- [LangChain](https://python.langchain.com/) - å¼·å¤§çš„ LLM æ‡‰ç”¨æ¡†æ¶
- [Google Gemini](https://ai.google.dev/) - å„ªç§€çš„ AI æ¨¡å‹
- [Kubernetes Python Client](https://github.com/kubernetes-client/python) - å®˜æ–¹ Python SDK
- [FastAPI](https://fastapi.tiangolo.com/) - ç¾ä»£åŒ–çš„ Web æ¡†æ¶

---

**å¦‚æœé€™ç¯‡æ–‡ç« å°ä½ æœ‰å¹«åŠ©ï¼Œæ­¡è¿ Star â­ æ”¯æŒä¸€ä¸‹ï¼**

æœ‰ä»»ä½•å•é¡Œæ­¡è¿åœ¨ [GitHub Issues](https://github.com/markku636/kubewizard/issues) è¨è«–ã€‚