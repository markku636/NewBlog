---
title: é€é KubeWizard æ‰“é€  LINE Bot Agent APIï¼šç”¨èŠå¤©æ–¹å¼ç®¡ç† Kubernetes
featured: true
date: 2025-10-30 10:00:00 +0800
thumbnail: kubewizard-linebot-agent-api.png
category: DevOps
author: Mark Ku
tags: ['KubeWizard', 'LINE Bot', 'Kubernetes', 'API', 'DevOps', 'Chatbot', 'Python', 'è‡ªå‹•åŒ–']
description: æ‰‹æŠŠæ‰‹å¸¶ä½ æŠŠ KubeWizard æ”¹é€ æˆ LINE Bot Agent APIï¼Œè®“ä½ ä¸é–‹é›»è…¦ã€ä¸ç”¨ kubectlï¼Œä¹Ÿèƒ½ç®¡ç† Kubernetesï¼Œé‚„èƒ½æ”¯æ´è‡ªå‹•åŒ–èˆ‡æ“´å……å·¥å…·ã€‚
slug: kubewizard-linebot-agent-api
---

## å‰è¨€

ç®¡ç† Kubernetesï¼Œå¤§å¤šæ•¸äººæœƒä½¿ç”¨ `kubectl` æˆ–é–‹å•Ÿ Dashboardã€‚  
ç„¶è€Œï¼Œè‹¥èƒ½é€éèŠå¤©çš„æ–¹å¼ç®¡ç† K8sï¼Œæ˜¯å¦æœƒæ›´ç›´è¦ºã€æ›´ä¾¿åˆ©ï¼Ÿ

æœ¬æ–‡å°‡ç¤ºç¯„å¦‚ä½•å°‡ **KubeWizard** æ‰“é€ æˆå¯åœ¨ LINE ä¸Šæ“ä½œçš„ **Kubernetes ç®¡ç†åŠ©ç†**ï¼š

- å¯ç›´æ¥å‚³è¨Šæ¯æŸ¥å¢é›†ç‹€æ…‹ã€æŸ¥çœ‹ Logsã€é‡å•Ÿæœå‹™
- åŒæ™‚æ”¯æ´ REST APIï¼Œå¯ä½œç‚ºäº‹ä»¶å…¥å£
- æ”¯æ´æ“´å……å·¥å…·ï¼ˆToolsï¼‰ã€è‡ªå‹•åŒ–èˆ‡ AI å”åŠ©

åœ¨ AI æ¨¡å‹çš„é¸æ“‡ä¸Šï¼Œæœ¬æ–‡ç¤ºç¯„ä½¿ç”¨çš„æ˜¯ **Google Gemini**ï¼š

- Gemini æœ‰æä¾› **å…è²»é¡åº¦ï¼ˆFree Tierï¼‰**ï¼Œå°æ–¼é–‹ç™¼é€™é¡ DevOps Agentã€èŠå¤©åŠ©ç†èˆ‡å¯¦é©—æ€§å°ˆæ¡ˆä¾†èªªï¼Œæµé‡é€šå¸¸éå¸¸å……è¶³
- API ä»‹é¢ç°¡å–®ï¼Œå®¹æ˜“èˆ‡ FastAPIã€Python SDK ç­‰å…ƒä»¶æ•´åˆ
- å°å¤šèªç³»ï¼ˆåŒ…å«ä¸­è‹±æ–‡æŠ€è¡“æ–‡ä»¶ã€æŒ‡ä»¤èªªæ˜ï¼‰ç†è§£èƒ½åŠ›ä¸éŒ¯ï¼Œé©åˆè™•ç†ç¶­é‹æƒ…å¢ƒçš„è‡ªç„¶èªè¨€äº’å‹•

ä»¥ä¸‹æ˜¯æˆªè‡³ 2025-11 çš„éƒ¨åˆ† **æ¨™æº– API Free Tier ä¸Šé™**ï¼ˆå¯¦éš›æ•¸å€¼è«‹ä»¥å®˜æ–¹æ–‡ä»¶ç‚ºæº–ï¼‰ï¼š

| æ¨¡å‹ | Free Tier æ¯åˆ†é˜è«‹æ±‚æ•¸ï¼ˆRPMï¼‰ | Free Tier æ¯åˆ†é˜ Token æ•¸ï¼ˆTPMï¼‰ |
|------|-------------------------------|-----------------------------------|
| Gemini 2.5 Flash | 10 | 250,000 |
| Gemini 2.5 Flash-Lite | 15 | 250,000 |
| Gemini 2.0 Flash | 15 | 1,000,000 |
| Gemini 2.0 Flash-Lite | 30 | 1,000,000 |
| Gemma 3 / 3n | 30 | 15,000 |
| Embeddingsï¼ˆGemini Embeddingï¼‰ | 100 | 30,000 |

> è¨»ï¼šä¸Šè¡¨åƒ…ç¯€éŒ„èˆ‡æœ¬æ–‡æƒ…å¢ƒè¼ƒç›¸é—œçš„æ¨¡å‹ï¼æ•¸å€¼ï¼Œæœªåˆ—å‡ºçš„æ¨¡å‹èˆ‡æœ€æ–°é™åˆ¶è«‹åƒè€ƒå®˜æ–¹èªªæ˜ã€‚

æ›´å¤šè©³æƒ…å¯åƒè€ƒå®˜æ–¹æ–‡ä»¶ï¼š

- [Gemini API Rate limits å®˜æ–¹æ–‡ä»¶](https://ai.google.dev/gemini-api/docs/rate-limits)

é€éæ­¤æ–¹å¼ï¼Œä½ ç„¡é ˆé–‹å•Ÿçµ‚ç«¯æ©Ÿï¼Œåœ¨é€šå‹¤ã€å¤–å‡ºæˆ–ä¼‘æ¯æ™‚å³å¯å®Œæˆè¨±å¤šç¶­é‹å·¥ä½œã€‚

---

## ç‚ºä»€éº¼ç”¨ LINE ä¾†åš K8s èŠå¤©åŠ©ç†

ä»¥ä¸‹æ˜¯æ­¤æ¨¡å¼èƒ½å¸¶ä¾†çš„ä¸»è¦åƒ¹å€¼ï¼š

### âœ… éš¨æ™‚éš¨åœ°å¯ç”¨

- ä¸éœ€ VPNã€ä¸éœ€ Terminal
- ä¸€æ”¯æ‰‹æ©Ÿå³å¯å®Œæˆå¸¸è¦‹ç¶­é‹æ“ä½œ

### ğŸ”— æ”¯æ´ API Gateway

KubeWizard å¯åŒæ™‚æä¾› **REST API**ï¼Œå¯æ•´åˆå„ç¨®äº‹ä»¶ä¾†æºï¼Œä¾‹å¦‚ï¼š

- Prometheus å‘Šè­¦è§¸ç™¼å¾Œé€šçŸ¥ LINE ä¸¦æä¾›æ“ä½œé¸é …
- GitLab Pipeline æˆåŠŸ/å¤±æ•—é€šçŸ¥èˆ‡ç›¸é—œæŒ‡ä»¤å»ºè­°
- Argo CD Drift ç›£æ§ä¸¦è©¢å•æ˜¯å¦è‡ªå‹•åŒæ­¥

### ğŸ§  å¯æ“´å……æˆ DevOps åŠ©ç†

æ”¯æ´ä»¥æ’ä»¶å½¢å¼æ“´å……å·¥å…·ï¼Œä¾‹å¦‚ï¼š

- æŸ¥è©¢ GitLab Pipeline ç‹€æ…‹
- æŸ¥è©¢ Jira Ticket ç‹€æ…‹
- åŸ·è¡Œç¶­é‹è‡ªå‹•åŒ– Script
- AI å”åŠ©åˆ†æ Log æˆ–ç”¢ç”Ÿ YAML

---

## Step 1ï¼šå»ºç«‹ LINE Bot

1. å‰å¾€ LINE Developersï¼š  
   https://developers.line.biz/console/

2. å»ºç«‹ Provider

3. å»ºç«‹ Messaging API Bot

4. å–å¾— Channel è¨­å®šä¸¦å¯«å…¥ `.env`ï¼š
```env
LINE_CHANNEL_SECRET=ä½ çš„_channel_secret
LINE_CHANNEL_ACCESS_TOKEN=ä½ çš„_access_token
```

5. è¨­å®š Webhook URLï¼Œä¾‹å¦‚ï¼š

```
https://your-domain.com/linebot/callback
```

![](linebot-console.png)
Webhook æ¸¬è©¦å¯ä½¿ç”¨ ngrok é€²è¡Œæœ¬åœ°å…¬é–‹ã€‚

### Webhook Settings å»ºè­°è¨­å®š

| é …ç›® | è¨­å®šå€¼ |
|-------|------------|
| Webhook URL | `https://example.com/linebot/callback` |
| Use webhook | âœ… å•Ÿç”¨ |

> éœ€ä½¿ç”¨ HTTPSã€‚æˆåŠŸå¾Œè«‹é»æ“Š Verify ç¢ºèªã€‚

---

## Step 2ï¼šå°‡ KubeWizard æ”¹é€ æˆã€ŒLINE Bot Agent APIã€

é è¨­çš„ KubeWizard å±¬æ–¼ä¸€æ¬¡æ€§æŸ¥è©¢å·¥å…·ï¼šå•ä¸€å¥ã€ç­”ä¸€å¥ã€‚  
æ¬²æå‡å¯ç”¨æ€§ï¼Œéœ€å°‡å…¶èª¿æ•´ç‚ºå…·å‚™è¨˜æ†¶èƒ½åŠ›ã€å·¥å…·åˆ¤æ–·èˆ‡å¤šå…¥å£èƒ½åŠ›çš„ Agentã€‚

### æ ¸å¿ƒè¨­è¨ˆæ¦‚å¿µ

| å…ƒä»¶ | åŠŸèƒ½ |
|------|--------|
| Agent | åˆ†æè¨Šæ¯èˆ‡æ±ºç­–æ˜¯å¦ä½¿ç”¨ Tools |
| Tools | ä»¥æ’ä»¶å½¢å¼æä¾›åŠŸèƒ½ï¼ˆK8sã€Pipelineã€AI ç­‰ï¼‰ |
| Memory | ä½¿ç”¨ Redis å„²å­˜ä¸Šä¸‹æ–‡èˆ‡ä½¿ç”¨è€…ç‹€æ…‹ |

### åŠŸèƒ½æ¨¡çµ„åŒ–ï¼ˆToolsï¼‰

æ¯é …åŠŸèƒ½ç¨ç«‹ç‚º Toolï¼Œå…·æœ‰é«˜æ“´å……æ€§ï¼š

```python
class K8sTool(BaseTool):
    name = "k8s_pods"
    description = "æŸ¥è©¢ Kubernetes Pods"

    def run(self, namespace: str):
        return kube_client.list_pods(namespace)
```
### Agent åˆ¤æ–·é‚è¼¯

```python
Agent â†’ åˆ†æè¨Šæ¯ â†’ é¸æ“‡ Tool â†’ åŸ·è¡Œ â†’ å›å‚³çµæœ
```

### è¨˜æ†¶åŠŸèƒ½ï¼ˆRedisï¼‰

ä½¿ç”¨ Redis å„²å­˜å°è©±ä¸Šä¸‹æ–‡ï¼Œä½¿ Bot èƒ½ç†è§£å‰å¾Œèªæ„ï¼š

```python
from langchain_community.chat_message_histories import RedisChatMessageHistory

chat_history = RedisChatMessageHistory(
    url="redis://localhost:6379/0",
    session_id=user_id,
    key_prefix="chat_history",
    ttl=3600
)

messages = chat_history.messages
chat_history.add_message(new_message)
```

---

### ç‚ºä»€éº¼é¸ Python SDK è€Œé kubectlï¼Ÿï¼ˆå¯æ”¯æ´ Pod å…§å¤–ï¼‰

KubeWizard ä½¿ç”¨ **Kubernetes Python SDK** æ“ä½œå¢é›†ï¼Œè€Œéå‘¼å« `kubectl` æŒ‡ä»¤ã€‚

**å„ªé»ï¼š**

- ä¸ä¾è³´ CLIï¼Œå®‰å…¨æ€§è¼ƒé«˜
- é¿å…å› å­—ä¸²è§£æå°è‡´é¢¨éšªèˆ‡ç¶­è­·å•é¡Œ
- å¯æ­é… RBAC ç²¾æº–æ§ç®¡æ¬Šé™

Python SDK åœ¨ **Pod å…§èˆ‡å¤–éƒ¨çš†å¯ä½¿ç”¨**ï¼š

| é‹è¡Œç’°å¢ƒ | è¼‰å…¥æ–¹å¼ | ç”¨é€” |
|---------|--------|--------|
| å¢é›†å…§ï¼ˆPodï¼‰ | `load_incluster_config()` | æ­£å¼éƒ¨ç½²èˆ‡æ¬Šé™æ§ç®¡ |
| å¤–éƒ¨ï¼ˆæœ¬åœ°/VMï¼‰ | `load_kube_config()` | é–‹ç™¼èˆ‡æ¸¬è©¦ |
è‡ªå‹•åµæ¸¬ç¯„ä¾‹ï¼š

```python
from kubernetes import client, config
import os

def load_k8s_config():
    if os.path.exists("/var/run/secrets/kubernetes.io/serviceaccount/token"):
        config.load_incluster_config()
    else:
        config.load_kube_config()

load_k8s_config()
```

---

## ç³»çµ±æ¶æ§‹åœ–

```mermaid
flowchart LR
    User[ä½¿ç”¨è€…ï¼ˆLINEï¼‰] <--> LINEWebhook[LINE Webhook]
    LINEWebhook --> FastAPI[FastAPI å…¥å£]
    FastAPI --> Agent[KubeWizard Agent]
    Agent <--> Redis[(Redis - è¨˜æ†¶èˆ‡ä¸Šä¸‹æ–‡)]
    Agent --> K8s[Kubernetes API]
```

---

## ğŸ›¡ï¸ RBAC æ¨©é™è¨­å®šï¼ˆå»ºè­°ï¼‰

ä»¥ä¸‹ç‚ºå»ºè­°çš„æœ€å°å¿…è¦æ¬Šé™ã€‚

### Namespace Scopedï¼ˆæ¨è–¦ï¼‰

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: kubewizard-bot-role
  namespace: default
rules:
  - apiGroups: [""]
    resources: ["pods", "services", "endpoints", "events", "configmaps", "secrets", "persistentvolumeclaims"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]

  - apiGroups: ["apps"]
    resources: ["deployments", "replicasets", "statefulsets", "daemonsets"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]

  - apiGroups: ["batch"]
    resources: ["jobs", "cronjobs"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]

  - apiGroups: ["networking.k8s.io"]
    resources: ["ingresses", "networkpolicies"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
```

---

## è³‡è¨Šæµç¤ºæ„ï¼ˆç™½è©±ç‰ˆï¼‰

ä½¿ç”¨è€…è¼¸å…¥ï¼š  
> ã€Œå¹«æˆ‘çœ‹ä¸€ä¸‹ kube-system è£¡çš„ Podsã€

æµç¨‹ï¼š

1. LINE æ”¶åˆ°è¨Šæ¯  
2. Webhook å‚³è‡³ FastAPI  
3. FastAPI å°‡å…§å®¹äº¤çµ¦ Agent  
4. Agent å¾ Redis å–å¾—ä¸Šä¸‹æ–‡  
5. Agent åˆ¤å®šéœ€ä½¿ç”¨ K8sTool  
6. åŸ·è¡Œ Python SDK æŸ¥è©¢å¢é›†  
7. å›å‚³å…§å®¹è‡³ LINE  

---

## Demo ç¤ºä¾‹ï¼ˆæ–‡å­—ç‰ˆï¼‰

**ä½ ï¼š** å¹«æˆ‘çœ‹ default namespace çš„ Pods  
**Botï¼š** å…± 12 å€‹ Podsï¼ˆ3 å€‹ Runningã€1 å€‹ CrashLoopBackOff...ï¼‰éœ€çœ‹ Logs å—ï¼Ÿ  
**ä½ ï¼š** çœ‹ä¸€ä¸‹å‰›å‰›é‚£å€‹ Crash çš„ Log  
**Botï¼š** ï¼ˆé¡¯ç¤º Logs ä¸¦æä¾›å¯èƒ½åŸå› ï¼‰  
**ä½ ï¼š** å¹«æˆ‘é‡å•Ÿçœ‹çœ‹  
**Botï¼š** å·²é‡å•Ÿ Deployment `payment-service`ï¼Œæ›´æ–°å¾Œç‹€æ…‹å›å ±ä¸­ã€‚  
![](result-1.png)
![](result-2.png)
---

## çµèª

æœ¬æ–‡ç¤ºç¯„å¦‚ä½•å°‡ KubeWizard æ•´åˆè‡³ LINE Botï¼Œæ‰“é€ å‡ºå¯ç®¡ç† K8s çš„èŠå¤©å¼åŠ©ç†ï¼Œå…·å‚™ï¼š

- Agent æ¨¡å‹èƒ½åŠ›
- è¨˜æ†¶èˆ‡ä¸Šä¸‹æ–‡
- Python SDK æ“ä½œå¢é›†
- RBAC æ¬Šé™æ§ç®¡