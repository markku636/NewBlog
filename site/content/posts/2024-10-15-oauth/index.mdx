---
featured: true
title: 使用 NestJS - 實作第三方 OAuth 授權登入服務
date:  2024-10-14 01:01:35 +0800
thumbnail:  oauth.png
category:  Fontend
tags:   ['nest','oauth' ]
description : 使用 NestJS - 實作第三方 OAuth 授權登入服務
author : Mark Ku
slug: practice-oauth-with-nestjs
---
## 前言
做了簡易的 OAuth 練習，就順便學了 NestJS (Node)後端框及 Prisma (ORM) 。

## 目的
開放授權（OAuth）是一個開放標準，廣泛用於社群授權登入，讓第三方網站可以不用取得使用者帳密，就能存取資源服務器資源。

## 流程圖
![Flow chart](flow-chart.png)

## 流程說明
1.在主網站按下登入按鈕，會透過 URL 將 redirect_uri 傳遞至 OAuth 登入頁面。  
2.使用者輸入帳號密碼完成登入後，系統會產生一個 code，並將其存入資料庫，然後將頁面重定向回電商網站的 callback 頁面，並將 code 透過 URL 傳遞過去。  
3.在 callback 頁面，前端可以從 URL 中獲取 code，並將其傳送至後端，透過 OAuth API 使用該 code 換取 access token。  
4.頁面會取得到的 access token，此時可以使用該 access token 去訪問資源伺服器，取得相關資訊，過期時則可以去換token。  

## 此次採用的技術架構是
* 前端(電商網站) - (Next.JS、Eslint、Pritter、React、Redux toolkit) - [程式碼](https://github.com/markku636/oauth.nextjs)
* 後端(OAuth 服務) -( Nest JS、Mysql、Prisma 、 Swagger 、 class-validator做資料驗證、並用Guard 做JWT的API驗證) - [程式碼](https://github.com/markku636/oauth.nest.api)
* 資料庫 MYsql

## Demo 
* [EC site](https://oauth-nextjs.letgo.com.tw)
* [Auth service api](https://oauth-nestjs-api.letgo.com.tw)
* [Swagger Url](https://oauth-nestjs-api.letgo.com.tw/docs) -  admin / 123
* [Demo影片](https://www.loom.com/share/fdac0b89ace64bc3b3ad5a85098d0499)

佈署環境
* 使用Powerhsell 佈署到Nas 
* GCP 反向代理 + 個人 Nas 伺服器伺服器

測試
* Jest
* Rest Clinet 

## 心得 
這是我第一次使用 NestJS 撰寫網站，發現它的開發體驗非常友好，NestJS 的模組化設計讓我聯想到 Angular 的依賴注入方式，同時也有點像 .NET MVC 的分層結構，搭配 Prisma，資料庫操作變得非常直觀，對於輕量型網站，NestJS 不僅開發速度快，還能輕鬆實現模組化和關注點分離，讓開發過程更加高效。

## 補充: 
type= token => 比較方便，但所有東西都藏在後端。
type= code  => 多打一次 request。


## 參考
* [參考資料1](https://docs.guandata.com/article/1/566167986377850880.html)
* [參考資料2](https://apifox.com/help/best-practices/how-to-test-oauth-2.0/)
* [參考資料3](https://www.youtube.com/watch?v=2rd_Ru7Bwkg&t=386s)