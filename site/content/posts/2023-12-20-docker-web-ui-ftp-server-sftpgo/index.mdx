---
featured: true
title:  使用 Cloudflare Tunnel 及 Docker 快速 架設 具有 Web UI 的 FTP Server - sftpgo
date:   2023-12-20 01:01:35 +0800
thumbnail:  ftp.png
category:  DevOps
tags:   ['ftp','docker','sftpgo']
description : 使用 Cloudflare Tunnel 及 Docker 快速 架設 具有 Web UI 的 FTP Server - sftpgo
author : Mark Ku
slug: docker-web-ui-ftp-server-sftpgo
---

## 時空背景
因為德國及美國的網站需要一套全新的ftp，因此花了些時間研究，試了幾套 docker ftp後，終於找到擁有 Web UI ，且開源 FTP 工具 sftpgo。

## 官方資料
[sftpgo官網](https://sftpgo.com/)  
[Github](https://github.com/drakkan/sftpgo)

## 預先準備
* 在宿主主機，安裝 Docker Desktop
* 安裝 Cloudfalre tunenl 
![image](1.png)

## 建立及啟動 FTP Docker 容器
```
docker run -d --name sftpgo --restart always -p 8080:8080 -p 2022:2022 -p 8090:8090 -e TZ=America/Los_Angeles -e SFTPGO_HTTPD__BINDINGS__0__PORT=8080  -e SFTPGO_WEBDAVD__BINDINGS__0__PORT=8090 -v E:\ftp1-data:/srv/sftpgo drakkan/sftpgo
```
### sftpgo 預設目錄
* SFTP/FTP/WebDAV預設目錄: /srv/sftpgo  
* 用戶預設目錄: /srv/sftpgo/data/{UserName}
* 主機金鑰目錄: /var/lib/sftpgo 

### SFTPGo TCP 埠：
* 2022 用於 SFTP 服務。  
* 8080 用於 Web 管理員用戶界面。  
* 8090 用於 Webdav


## 訪問Web 管理員用戶界面，建立後台管理帳號 - [連結](http://localhost:8080/web/admin/setup)

![image](2.png)

## 登入後點擊菜單中的 Users > 點擊新增按鈕 + > 建立 ftp 帳號 - [連結](http://localhost:8080/web/admin/login)
![image](3.png)
P.S.Home Dir預設目錄/srv/sftpgo/data/{你的帳號名}，因為想每個帳號預設的目錄都是 /srv/sftpgo/cdn 

## 測試 web client url - [連結](http://localhost:8080/web/client/login)

## 使用 FileZilla Client 做測試
### 1.[下載及安裝FileZilla Client](https://filezilla-project.org/)
### 2.檔案 > 站台管理員 > 新增站台 > 協定選擇 『SFTP - SSH Transfer Protocol』
![image](4.png)

## Windows 掛載 WebDEV 資料夾
### 1.設置完整的註冊檔路徑，用管理權限Powershell 執行以下指令
```
// 設定
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\WebClient\Parameters" -Name "BasicAuthLevel" -Value 2

// 檢查 BasicAuthLevel
Get-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\WebClient\Parameters" -Name "BasicAuthLevel"

// 重新啟動 webclient
net stop webclient
net start webclient
```

### 2.開啟本機 > 點擊 ... > 新增一個網路位置
![image](5.png)
### 3. 輸入 WebDev 的主機及IP 及帳密
![image](6.png)

### 4.下一步
![image](7.png)

### 5.新增完成
![image](8.png)

## 參考資料
[參考資料](https://blog.csdn.net/networken/article/details/133963932)  





